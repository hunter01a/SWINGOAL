<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SWINGOL - Crypto Social Gaming Platform</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --dark: #0A0E1A;
            --dark-secondary: #141823;
            --dark-tertiary: #1E2330;
            --dark-card: #252A3A;
            --light: #FFFFFF;
            --gray: #94A3B8;
            --gray-dark: #64748B;
            --neon-blue: #00D4FF;
            --neon-pink: #FF10F0;
            --neon-green: #10FFB5;
            --crypto-gold: #FFD700;
            --crypto-purple: #9333EA;
            --danger: #FF4444;
            --success: #10B981;
            --warning: #F59E0B;
            --gradient-primary: linear-gradient(135deg, #00D4FF 0%, #FF10F0 100%);
            --gradient-gold: linear-gradient(135deg, #FFD700 0%, #FF8C00 100%);
            --gradient-vip: linear-gradient(135deg, #FFD700 0%, #FF10F0 50%, #00D4FF 100%);
            --gradient-affinity-high: linear-gradient(135deg, #FF10F0 0%, #FFD700 100%);
            --gradient-affinity-medium: linear-gradient(135deg, #00D4FF 0%, #10FFB5 100%);
            --gradient-affinity-low: linear-gradient(135deg, #475569 0%, #334155 100%);
            --gradient-quest: linear-gradient(135deg, #10B981 0%, #059669 100%);
            --gradient-game: linear-gradient(135deg, #F59E0B 0%, #DC2626 100%);
            --gradient-futuristic: linear-gradient(135deg, #FF00FF 0%, #00FFFF 50%, #FFFF00 100%);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow-neon: 0 0 40px rgba(0, 212, 255, 0.5);
            --shadow-neon-pink: 0 0 40px rgba(255, 16, 240, 0.5);
            --shadow-gold: 0 0 40px rgba(255, 215, 0, 0.5);
        }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--dark);
            color: var(--light);
            overflow: hidden;
            height: 100vh;
            position: relative;
        }
        
        body.day-mode {
            --dark: #FFFFFF;
            --dark-secondary: #F8F9FA;
            --dark-tertiary: #E9ECEF;
            --dark-card: #DEE2E6;
            --light: #212529;
            --gray: #6C757D;
            --gray-dark: #495057;
            --glass: rgba(0, 0, 0, 0.02);
            --glass-border: rgba(0, 0, 0, 0.06);
        }
        
        /* Hide Leaflet default controls */
        .leaflet-control-zoom {
            display: none !important;
        }
        
        /* App Container */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            height: 100vh;
            position: relative;
            background: var(--dark);
            display: flex;
            flex-direction: column;
        }
        
        /* Glass Morphism Card */
        .glass-card {
            background: var(--dark-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
        }
        
        /* Enhanced Tri-Tab Selection Screen */
        .tri-tab-selection {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-secondary) 100%);
            z-index: 10001;
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tri-tab-selection.hidden {
            transform: translateX(-100%);
        }
        
        .logo-container {
            text-align: center;
            padding: 2rem;
            position: relative;
        }
        
        .logo-main {
            font-family: 'Orbitron', monospace;
            font-size: 3.5rem;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            letter-spacing: -2px;
            animation: logoGlow 3s infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px rgba(0, 212, 255, 0.5)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 40px rgba(255, 16, 240, 0.5)); }
        }
        
        .logo-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
            font-family: 'Orbitron', monospace;
        }
        
        .luxlab-credit {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--gray);
            opacity: 0.6;
            font-style: italic;
        }
        
        /* Tri-Tab Navigation */
        .tri-tabs {
            display: flex;
            background: var(--dark-card);
            border-radius: 16px;
            padding: 0.25rem;
            margin: 0 2rem 1.5rem;
            position: relative;
        }
        
        .tri-tab {
            flex: 1;
            padding: 0.75rem;
            background: transparent;
            border: none;
            color: var(--gray);
            font-weight: 600;
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        .tri-tab.active {
            color: var(--light);
        }
        
        .tri-tab-indicator {
            position: absolute;
            height: calc(100% - 0.5rem);
            width: calc(33.33% - 0.33rem);
            background: var(--gradient-primary);
            border-radius: 12px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            top: 0.25rem;
            left: 0.25rem;
        }
        
        .tri-tab-indicator.tab-2 {
            transform: translateX(calc(100% + 0.16rem));
        }
        
        .tri-tab-indicator.tab-3 {
            transform: translateX(calc(200% + 0.33rem));
        }
        
        /* Tab Content Sections */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 0 2rem 2rem;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Section Cards */
        .section-card {
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: var(--dark-card);
            border: 2px solid var(--glass-border);
            margin-bottom: 1rem;
        }
        
        .section-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .section-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--neon-blue);
            box-shadow: var(--shadow-neon);
        }
        
        .section-card:hover::before {
            opacity: 0.1;
        }
        
        .section-content {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .section-icon {
            font-size: 2rem;
        }
        
        .section-info {
            flex: 1;
        }
        
        .section-title {
            font-weight: 700;
            margin-bottom: 0.25rem;
            font-family: 'Orbitron', monospace;
        }
        
        .section-desc {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        /* Professional Setup */
        .professional-setup {
            display: none;
            padding: 2rem;
            max-width: 480px;
            margin: 0 auto;
            height: 100vh;
            overflow-y: auto;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-secondary) 100%);
        }
        
        .professional-setup.active {
            display: block;
        }
        
        /* Venue Setup */
        .venue-setup {
            display: none;
            padding: 2rem;
            max-width: 480px;
            margin: 0 auto;
            height: 100vh;
            overflow-y: auto;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-secondary) 100%);
        }
        
        .venue-setup.active {
            display: block;
        }
        
        /* File Upload */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
        }
        
        .file-upload-label {
            display: block;
            padding: 1rem;
            background: var(--dark-card);
            border: 2px dashed var(--neon-blue);
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .file-upload-label:hover {
            background: var(--dark-tertiary);
            border-color: var(--crypto-gold);
        }
        
        /* OTP Verification */
        .otp-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10003;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .otp-modal.active {
            display: flex;
        }
        
        .otp-container {
            max-width: 400px;
            width: 100%;
            padding: 2rem;
            text-align: center;
            background: var(--dark-card);
        }
        
        .otp-inputs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .otp-input {
            width: 50px;
            height: 50px;
            border: 2px solid var(--neon-blue);
            background: var(--dark-secondary);
            border-radius: 12px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light);
            transition: all 0.3s ease;
        }
        
        .otp-input:focus {
            outline: none;
            border-color: var(--crypto-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        /* Onboarding Screen */
        .onboarding-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-secondary) 100%);
            z-index: 10000;
            max-width: 480px;
            margin: 0 auto;
            padding: 2rem;
            overflow-y: auto;
            display: none;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .onboarding-screen.active {
            display: block;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--glass-border);
            background: var(--dark-card);
            border-radius: 12px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--neon-blue);
            background: var(--dark-tertiary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }
        
        /* Mood Selector */
        .mood-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .mood-card {
            padding: 1.5rem 0.5rem;
            border: 2px solid var(--glass-border);
            background: var(--dark-card);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mood-card.active {
            transform: scale(1.05);
            border-color: currentColor;
            box-shadow: 0 0 30px currentColor;
        }
        
        .mood-card.green {
            color: var(--success);
        }
        
        .mood-card.green.active {
            background: rgba(16, 185, 129, 0.1);
        }
        
        .mood-card.yellow {
            color: var(--warning);
        }
        
        .mood-card.yellow.active {
            background: rgba(245, 158, 11, 0.1);
        }
        
        .mood-card.red {
            color: var(--danger);
        }
        
        .mood-card.red.active {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Main Button */
        .btn-primary {
            width: 100%;
            padding: 1rem;
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Orbitron', monospace;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.5);
        }
        
        .btn-secondary {
            width: 100%;
            padding: 1rem;
            background: var(--dark-card);
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            color: var(--light);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Orbitron', monospace;
        }
        
        .btn-secondary:hover {
            background: var(--dark-tertiary);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }
        
        /* App Header */
        .app-header {
            background: var(--dark-secondary);
            backdrop-filter: blur(20px);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--neon-blue);
            position: relative;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 212, 255, 0.2);
        }
        
        .user-info-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px currentColor;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        .currency-container {
            display: flex;
            gap: 0.5rem;
        }
        
        .currency-badge {
            padding: 0.5rem 0.75rem;
            background: var(--dark-card);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .currency-badge:hover {
            transform: scale(1.05);
            border-color: var(--crypto-gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .level-badge {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            border: none;
        }
        
        .vip-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--gradient-vip);
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 700;
            animation: vipGlow 2s infinite;
        }
        
        @keyframes vipGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 16, 240, 0.5); }
        }
        
        /* Map Container */
        .map-wrapper {
            flex: 1;
            position: relative;
            background: var(--dark-secondary);
            overflow: hidden;
            border: 2px solid var(--glass-border);
        }
        
        #map {
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
        }
        
        /* Futuristic Zone Markers */
        .zone-marker {
            position: absolute;
            padding: 0.75rem 1rem;
            background: var(--dark-card);
            backdrop-filter: blur(10px);
            border: 2px solid;
            border-image: linear-gradient(45deg, #00D4FF, #FF10F0, #FFD700) 1;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 500;
            transform: translate(-50%, -50%);
            color: var(--light);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            clip-path: polygon(5% 0%, 100% 0%, 95% 100%, 0% 100%);
        }
        
        .zone-marker::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: var(--gradient-futuristic);
            border-radius: 16px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
            filter: blur(10px);
        }
        
        .zone-marker:hover {
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 501;
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
        }
        
        .zone-marker:hover::after {
            opacity: 0.5;
        }
        
        .zone-marker.affinity-high {
            background: var(--gradient-affinity-high);
            border-color: var(--neon-pink);
            color: white;
            animation: pulseHigh 2s infinite;
        }
        
        .zone-marker.affinity-medium {
            background: var(--gradient-affinity-medium);
            border-color: var(--neon-blue);
            color: white;
            animation: pulseMedium 2s infinite;
        }
        
        .zone-marker.affinity-low {
            background: var(--gradient-affinity-low);
            border-color: var(--gray-dark);
            color: white;
        }
        
        @keyframes pulseHigh {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 16, 240, 0.6); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        
        @keyframes pulseMedium {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.6); }
            50% { box-shadow: 0 0 30px rgba(16, 255, 181, 0.8); }
        }
        
        /* Map Controls */
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 1000;
        }
        
        .map-btn {
            width: 40px;
            height: 40px;
            background: var(--dark-card);
            backdrop-filter: blur(10px);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            color: var(--light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }
        
        .map-btn:hover {
            transform: scale(1.1);
            background: var(--neon-blue);
            color: var(--dark);
            box-shadow: var(--shadow-neon);
        }
        
        /* AI Suggestion Banner */
        .ai-suggestion {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 60px;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(255, 16, 240, 0.2), rgba(0, 212, 255, 0.2));
            backdrop-filter: blur(15px);
            border: 2px solid var(--neon-pink);
            border-radius: 12px;
            display: none;
            z-index: 999;
            animation: slideInTop 0.5s ease;
            box-shadow: var(--shadow-neon-pink);
        }
        
        .ai-suggestion.active {
            display: block;
        }
        
        @keyframes slideInTop {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Zone Popup */
        .zone-popup {
            position: absolute;
            bottom: 80px;
            left: 10px;
            right: 10px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 1.5rem;
            display: none;
            z-index: 1000;
            animation: slideUp 0.3s ease;
            background: var(--dark-card);
            border: 2px solid var(--neon-blue);
            box-shadow: var(--shadow-neon);
        }
        
        .zone-popup.active {
            display: block;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Suggestion System */
        .suggestion-panel {
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(147, 51, 234, 0.1));
            border: 2px solid var(--crypto-gold);
            border-radius: 16px;
            margin-top: 1.5rem;
        }
        
        .suggestion-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .suggestion-icon {
            font-size: 2rem;
        }
        
        .suggestion-title {
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            color: var(--crypto-gold);
        }
        
        .suggestion-desc {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }
        
        .suggestion-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .suggestion-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .suggestion-rewards {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--dark-secondary);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .suggestion-rewards-amount {
            color: var(--crypto-gold);
            font-weight: 700;
        }
        
        /* Enhanced Treasure Hunt Overlay */
        .treasure-hunt-overlay {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 20px);
            max-width: 460px;
            background: linear-gradient(135deg, var(--dark-card), var(--dark-secondary));
            border: 3px solid;
            border-image: linear-gradient(45deg, #FFD700, #FF10F0, #00D4FF) 1;
            border-radius: 20px;
            padding: 1rem;
            display: none;
            z-index: 1001;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-gold);
        }
        
        .treasure-hunt-overlay.active {
            display: block;
            animation: treasureSlideUp 0.5s ease;
        }
        
        @keyframes treasureSlideUp {
            from { transform: translateX(-50%) translateY(100%); }
            to { transform: translateX(-50%) translateY(0); }
        }
        
        #treasureMap {
            width: 100%;
            height: 200px;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 2px solid var(--crypto-gold);
            position: relative;
        }
        
        /* Compass Indicator */
        .compass-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: var(--dark-card);
            border: 2px solid var(--crypto-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .compass-needle {
            width: 30px;
            height: 30px;
            position: relative;
            transition: transform 0.5s ease;
        }
        
        .compass-needle::before {
            content: '▲';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--danger);
            font-size: 20px;
        }
        
        .treasure-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .treasure-stat {
            text-align: center;
            padding: 0.5rem;
            background: var(--dark-secondary);
            border-radius: 8px;
            border: 1px solid var(--crypto-gold);
        }
        
        .treasure-distance {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--crypto-gold);
            font-family: 'Orbitron', monospace;
        }
        
        .treasure-eta {
            font-size: 1rem;
            color: var(--neon-blue);
            font-family: 'Orbitron', monospace;
        }
        
        .treasure-ratio {
            font-size: 1rem;
            color: var(--neon-green);
            font-family: 'Orbitron', monospace;
        }
        
        /* Proximity Alert */
        .proximity-alert {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 16, 240, 0.2));
            border: 1px solid var(--crypto-gold);
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            display: none;
        }
        
        .proximity-alert.active {
            display: block;
            animation: proximityPulse 1s infinite;
        }
        
        @keyframes proximityPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .treasure-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .treasure-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .treasure-btn.book {
            background: var(--gradient-gold);
            color: var(--dark);
        }
        
        .treasure-btn.cancel {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }
        
        /* Group booking panel */
        .group-booking-panel {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            width: calc(100% - 40px);
            max-width: 440px;
            background: var(--dark-card);
            border: 2px solid var(--crypto-purple);
            border-radius: 20px;
            padding: 1.5rem;
            z-index: 1002;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .group-booking-panel.active {
            transform: translateX(-50%) scale(1);
        }
        
        /* Venue Booking Panel */
        .venue-booking-panel {
            position: fixed;
            bottom: 300px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            width: calc(100% - 40px);
            max-width: 440px;
            background: var(--dark-card);
            border: 2px solid var(--crypto-gold);
            border-radius: 20px;
            padding: 1.5rem;
            z-index: 1002;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .venue-booking-panel.active {
            transform: translateX(-50%) scale(1);
        }
        
        .venue-card {
            padding: 1rem;
            background: var(--dark-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .venue-card:hover {
            border-color: var(--crypto-gold);
            transform: translateX(5px);
        }
        
        /* Match Request Notification */
        .match-request {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            width: calc(100% - 40px);
            max-width: 440px;
            background: linear-gradient(135deg, rgba(255, 16, 240, 0.95), rgba(0, 212, 255, 0.95));
            border-radius: 20px;
            padding: 1.5rem;
            z-index: 1002;
            color: white;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: var(--shadow-neon-pink);
        }
        
        .match-request.active {
            transform: translateX(-50%) scale(1);
        }
        
        /* AD Banner */
        .ad-banner {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            height: 60px;
            background: linear-gradient(135deg, var(--dark-card), var(--dark-secondary));
            border: 2px solid var(--crypto-purple);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            z-index: 998;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ad-banner:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(147, 51, 234, 0.3);
        }
        
        .ad-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .ad-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .ad-text {
            flex: 1;
        }
        
        .ad-title {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .ad-desc {
            font-size: 0.75rem;
            color: var(--gray);
        }
        
        .ad-close {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ad-close:hover {
            background: var(--danger);
            transform: rotate(90deg);
        }
        
        /* Interest Detail Modal */
        .interest-detail-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10004;
            padding: 2rem;
        }
        
        .interest-detail-modal.active {
            display: flex;
        }
        
        .interest-detail-content {
            max-width: 400px;
            width: 100%;
            padding: 2rem;
            background: var(--dark-card);
        }
        
        /* User Card */
        .user-card {
            padding: 1rem;
            background: var(--dark-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .user-card:hover {
            transform: translateX(5px);
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .user-bio {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .affinity-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.25rem 0.5rem;
            background: var(--gradient-primary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
        }
        
        /* Activity Feed Item */
        .activity-item {
            padding: 0.75rem;
            background: var(--dark-secondary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.85rem;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            border-color: var(--neon-blue);
            transform: translateX(5px);
        }
        
        .activity-icon {
            font-size: 1.5rem;
        }
        
        .activity-text {
            flex: 1;
        }
        
        .activity-time {
            color: var(--gray);
            font-size: 0.75rem;
        }
        
        .activity-zone {
            color: var(--neon-pink);
            font-weight: 600;
        }
        
        .activity-user {
            color: var(--crypto-gold);
            font-weight: 600;
        }
        
        /* Bottom Navigation */
        .bottom-bar {
            background: var(--dark-secondary);
            backdrop-filter: blur(20px);
            border-top: 2px solid var(--neon-blue);
            position: relative;
            z-index: 999;
            box-shadow: 0 -2px 20px rgba(0, 212, 255, 0.2);
        }
        
        .bottom-nav {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            padding: 0.5rem 0;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: var(--gray);
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            position: relative;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--neon-blue);
            transition: width 0.3s ease;
        }
        
        .nav-btn.active {
            color: var(--neon-blue);
        }
        
        .nav-btn.active::before {
            width: 30px;
        }
        
        .nav-icon {
            font-size: 1.2rem;
        }
        
        .nav-label {
            font-size: 0.55rem;
            font-weight: 500;
            font-family: 'Orbitron', monospace;
        }
        
        /* SOS Button */
        .sos-button {
            position: absolute;
            bottom: 90px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--danger), #DC2626);
            border: none;
            border-radius: 50%;
            color: white;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.4);
            z-index: 1001;
            transition: all 0.3s ease;
            animation: sosPulse 2s infinite;
        }
        
        @keyframes sosPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 5px 20px rgba(255, 68, 68, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 5px 30px rgba(255, 68, 68, 0.6); }
        }
        
        /* Treasure Found Animation */
        .treasure-found-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--gradient-vip);
            padding: 2rem;
            border-radius: 20px;
            color: white;
            text-align: center;
            z-index: 10005;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .treasure-found-modal.active {
            transform: translate(-50%, -50%) scale(1);
            animation: treasureGlow 1s ease infinite;
        }
        
        @keyframes treasureGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
            50% { box-shadow: 0 0 60px rgba(255, 215, 0, 1), 0 0 100px rgba(255, 16, 240, 0.5); }
        }
        
        /* Enhanced Games */
        .game-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.98);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10006;
        }
        
        .game-overlay.active {
            display: flex;
        }
        
        /* Roulette Enhancements */
        .roulette-container {
            text-align: center;
            padding: 2rem;
        }
        
        .roulette-wheel {
            width: 250px;
            height: 250px;
            margin: 2rem auto;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #FF4444 0deg 10deg,
                #0A0E1A 10deg 20deg,
                #FF4444 20deg 30deg,
                #0A0E1A 30deg 40deg,
                #FF4444 40deg 50deg,
                #0A0E1A 50deg 60deg,
                #10B981 60deg 70deg,
                #0A0E1A 70deg 80deg,
                #FF4444 80deg 90deg,
                #0A0E1A 90deg 100deg,
                #FF4444 100deg 110deg,
                #0A0E1A 110deg 120deg,
                #FFD700 120deg 140deg,
                #0A0E1A 140deg 360deg
            );
            border: 5px solid var(--crypto-gold);
            position: relative;
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.5),
                inset 0 0 50px rgba(0, 0, 0, 0.5);
        }
        
        .roulette-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid var(--crypto-gold);
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
        }
        
        .roulette-wheel.spinning {
            animation: spinWheel 5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        
        @keyframes spinWheel {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(2520deg); }
        }
        
        .roulette-result {
            margin-top: 2rem;
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .roulette-result.show {
            opacity: 1;
            animation: resultGlow 1s ease infinite;
        }
        
        @keyframes resultGlow {
            0%, 100% { text-shadow: 0 0 20px currentColor; }
            50% { text-shadow: 0 0 40px currentColor, 0 0 60px currentColor; }
        }
        
        /* Scratch Card */
        .scratch-container {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 2rem auto;
        }
        
        #scratchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .scratch-result {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-gold);
            border-radius: 12px;
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* Slot Machine */
        .slot-machine {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .slot-reel {
            width: 80px;
            height: 100px;
            background: var(--dark-card);
            border: 3px solid var(--crypto-gold);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .slot-symbols {
            position: absolute;
            top: 0;
            width: 100%;
            transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        
        .slot-symbol {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        
        .slot-machine.spinning .slot-symbols {
            transform: translateY(-2000px);
        }
        
        /* Modals */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            width: 100%;
            max-width: 440px;
            max-height: 90vh;
            background: var(--dark-card);
            border: 2px solid var(--neon-blue);
            border-radius: 20px;
            overflow-y: auto;
            box-shadow: var(--shadow-neon);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--glass-border);
            background: transparent;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            transform: rotate(90deg);
            border-color: var(--danger);
            background: var(--danger);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        /* Quest System */
        .quest-container {
            display: grid;
            gap: 1rem;
        }
        
        .quest-card {
            background: var(--dark-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .quest-card.daily {
            border-color: var(--neon-blue);
        }
        
        .quest-card.weekly {
            border-color: var(--crypto-gold);
        }
        
        .quest-card.completed {
            opacity: 0.6;
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .quest-info {
            flex: 1;
        }
        
        .quest-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }
        
        .quest-progress {
            font-size: 0.75rem;
            color: var(--gray);
        }
        
        .quest-progress-bar {
            width: 100%;
            height: 4px;
            background: var(--dark-card);
            border-radius: 2px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .quest-progress-fill {
            height: 100%;
            background: var(--gradient-quest);
            transition: width 0.5s ease;
        }
        
        .quest-reward {
            text-align: right;
            padding-left: 1rem;
        }
        
        .quest-reward-amount {
            font-weight: 700;
            color: var(--crypto-gold);
            font-size: 1rem;
        }
        
        .quest-reward-type {
            font-size: 0.7rem;
            color: var(--gray);
        }
        
        /* Streak Display */
        .streak-container {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(147, 51, 234, 0.1));
            border: 2px solid var(--crypto-gold);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .streak-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--crypto-gold);
            font-family: 'Orbitron', monospace;
        }
        
        .streak-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        /* Activity Feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Games */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .game-card {
            padding: 1.5rem;
            background: var(--dark-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            border-color: var(--crypto-gold);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        
        .game-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .game-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .game-cost {
            color: var(--crypto-gold);
            font-size: 0.85rem;
        }
        
        /* Shop */
        .shop-item {
            padding: 1rem;
            background: var(--dark-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .shop-btn {
            padding: 0.5rem 1rem;
            background: var(--gradient-primary);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* Profile Interests */
        .interests-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .interest-chip {
            padding: 0.75rem 0.5rem;
            background: var(--dark-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            font-size: 0.85rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interest-chip.active {
            background: var(--gradient-primary);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 1rem 1.5rem;
            background: var(--dark-card);
            backdrop-filter: blur(20px);
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            box-shadow: var(--shadow-neon);
            z-index: 10001;
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 90%;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Leaflet Custom */
        .leaflet-container {
            background: var(--dark-secondary);
        }
        
        .leaflet-popup-content-wrapper {
            background: var(--dark-card);
            backdrop-filter: blur(20px);
            border: 2px solid var(--neon-blue);
        }
        
        .leaflet-popup-tip {
            background: var(--dark-card);
        }
        
        /* Futuristic Zone boundaries on map */
        .zone-boundary {
            fill: var(--neon-blue);
            fill-opacity: 0.1;
            stroke: var(--neon-blue);
            stroke-width: 2;
            stroke-opacity: 0.5;
            transition: all 0.3s ease;
            stroke-dasharray: 5, 10;
            animation: boundaryPulse 3s infinite;
        }
        
        @keyframes boundaryPulse {
            0%, 100% { stroke-opacity: 0.3; }
            50% { stroke-opacity: 0.8; }
        }
        
        .zone-boundary:hover {
            fill-opacity: 0.2;
            stroke-opacity: 1;
            stroke-width: 3;
        }
        
        .zone-boundary.affinity-high {
            fill: var(--neon-pink);
            stroke: var(--neon-pink);
        }
        
        .zone-boundary.affinity-medium {
            fill: var(--neon-green);
            stroke: var(--neon-green);
        }
        
        .zone-boundary.affinity-low {
            fill: var(--gray);
            stroke: var(--gray);
        }
        
        /* Particles effect for games */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10007;
        }
        
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--crypto-gold);
            border-radius: 50%;
            animation: particleFall 3s linear infinite;
        }
        
        @keyframes particleFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Checkbox */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-label {
            font-size: 0.9rem;
            color: var(--gray);
            cursor: pointer;
        }
        
        /* Back Button */
        .back-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            width: 40px;
            height: 40px;
            background: var(--dark-card);
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            color: var(--light);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .back-btn:hover {
            transform: scale(1.1);
            background: var(--neon-blue);
            color: var(--dark);
        }
        
        /* Live Activity Board */
        .live-activity-board {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(255, 16, 240, 0.1));
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .live-activity-title {
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            color: var(--neon-blue);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .live-pulse {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: livePulse 1s infinite;
        }
        
        @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <!-- Enhanced Tri-Tab Selection -->
    <div class="tri-tab-selection" id="triTabSelection">
        <div class="logo-container">
            <div class="logo-main">SWINGOL</div>
            <div class="logo-subtitle">Crypto Social Gaming Platform</div>
            <div class="luxlab-credit">Powered by LuxLab.it</div>
        </div>
        
        <!-- Tri-Tab Navigation -->
        <div class="tri-tabs">
            <div class="tri-tab-indicator" id="tabIndicator"></div>
            <button class="tri-tab active" onclick="switchMainTab(1, this)">SOCIAL</button>
            <button class="tri-tab" onclick="switchMainTab(2, this)">PROFESSIONAL</button>
            <button class="tri-tab" onclick="switchMainTab(3, this)">LOCALI</button>
        </div>
        
        <!-- Tab 1: Social (Utenti Singoli e Gruppi) -->
        <div class="tab-content active" id="tabContent1">
            <div class="section-card glass-card" onclick="selectUserType('single')">
                <div class="section-content">
                    <div class="section-icon">👤</div>
                    <div class="section-info">
                        <div class="section-title">UTENTE SINGOLO</div>
                        <div class="section-desc">Esplora la città, incontra persone e guadagna SWING</div>
                    </div>
                </div>
            </div>
            
            <div class="section-card glass-card" onclick="selectUserType('group')">
                <div class="section-content">
                    <div class="section-icon">👥</div>
                    <div class="section-info">
                        <div class="section-title">GRUPPO</div>
                        <div class="section-desc">Organizza uscite di gruppo e prenota locali insieme</div>
                    </div>
                </div>
            </div>
            
            <div class="section-card glass-card" onclick="selectUserType('vip')">
                <div class="section-content">
                    <div class="section-icon">⭐</div>
                    <div class="section-info">
                        <div class="section-title">VIP EXPERIENCE</div>
                        <div class="section-desc">Accesso completo a tutte le funzionalità premium</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab 2: Professional -->
        <div class="tab-content" id="tabContent2">
            <div class="section-card glass-card" onclick="selectUserType('guide')">
                <div class="section-content">
                    <div class="section-icon">🎯</div>
                    <div class="section-info">
                        <div class="section-title">GUIDE TURISTICHE</div>
                        <div class="section-desc">Offri tour personalizzati e servizi turistici</div>
                    </div>
                </div>
            </div>
            
            <div class="section-card glass-card" onclick="selectUserType('photographer')">
                <div class="section-content">
                    <div class="section-icon">📸</div>
                    <div class="section-info">
                        <div class="section-title">FOTOGRAFI</div>
                        <div class="section-desc">Servizi fotografici professionali per turisti</div>
                    </div>
                </div>
            </div>
            
            <div class="section-card glass-card" onclick="selectUserType('influencer')">
                <div class="section-content">
                    <div class="section-icon">🌟</div>
                    <div class="section-info">
                        <div class="section-title">INFLUENCER</div>
                        <div class="section-desc">Promuovi esperienze e guadagna con i tuoi follower</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab 3: Locali -->
        <div class="tab-content" id="tabContent3">
            <div class="section-card glass-card" onclick="selectUserType('restaurant')">
                <div class="section-content">
                    <div class="section-icon">🍝</div>
                    <div class="section-info">
                        <div class="section-title">RISTORANTI</div>
                        <div class="section-desc">Gestisci prenotazioni e offerte speciali</div>
                    </div>
                </div>
            </div>
            
            <div class="section-card glass-card" onclick="selectUserType('bar')">
                <div class="section-content">
                    <div class="section-icon">🍸</div>
                    <div class="section-info">
                        <div class="section-title">BAR & CLUB</div>
                        <div class="section-desc">Eventi esclusivi e liste VIP</div>
                    </div>
                </div>
            </div>
            
            <div class="section-card glass-card" onclick="selectUserType('venue')">
                <div class="section-content">
                    <div class="section-icon">🏪</div>
                    <div class="section-info">
                        <div class="section-title">ALTRI LOCALI</div>
                        <div class="section-desc">Hotel, negozi, servizi vari</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Professional Setup Screen -->
    <div class="professional-setup" id="professionalSetup">
        <button class="back-btn" onclick="backToSelection()">←</button>
        <div style="text-align: center; margin-bottom: 2rem; margin-top: 3rem;">
            <div style="font-size: 2.5rem; font-weight: 800; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: 'Orbitron', monospace;">
                PROFESSIONISTI
            </div>
            <div style="color: var(--gray); margin-top: 0.5rem;">Configura il tuo profilo professionale</div>
        </div>
        
        <div class="form-group">
            <label class="form-label">👤 Nome Completo</label>
            <input type="text" class="form-input" placeholder="Mario Rossi" id="guideName">
        </div>
        
        <div class="form-group">
            <label class="form-label">📧 Email Professionale</label>
            <input type="email" class="form-input" placeholder="info@example.com" id="guideEmail">
        </div>
        
        <div class="form-group">
            <label class="form-label">📱 Telefono</label>
            <input type="tel" class="form-input" placeholder="+39 333 1234567" id="guidePhone">
        </div>
        
        <div class="form-group">
            <label class="form-label">🏢 Partita IVA</label>
            <input type="text" class="form-input" placeholder="12345678901" id="guideVat">
        </div>
        
        <div class="form-group">
            <label class="form-label">🎯 Tipo di Servizio</label>
            <select class="form-select" id="guideService">
                <option value="tour">Tour Guidati</option>
                <option value="experience">Esperienze Esclusive</option>
                <option value="food">Food & Wine Tours</option>
                <option value="art">Visite Artistiche</option>
                <option value="photography">Tour Fotografici</option>
                <option value="personal">Personal Shopper</option>
                <option value="wellness">Wellness Experience</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">📝 Descrizione Servizio</label>
            <textarea class="form-textarea" placeholder="Descrivi il tuo servizio..." id="guideDescription"></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">💰 Prezzo per Persona (€)</label>
            <input type="number" class="form-input" placeholder="50" id="guidePrice">
        </div>
        
        <div class="form-group">
            <label class="form-label">📄 Carica Brochure PDF</label>
            <div class="file-upload">
                <input type="file" accept=".pdf" id="guideBrochure">
                <label for="guideBrochure" class="file-upload-label">
                    <div>📁 Clicca per caricare</div>
                    <div style="font-size: 0.8rem; color: var(--gray); margin-top: 0.5rem;">Max 10MB - Solo PDF</div>
                </label>
            </div>
        </div>
        
        <div class="checkbox-container">
            <input type="checkbox" id="guideTerms">
            <label for="guideTerms" class="checkbox-label">Accetto i termini per professionisti e il pagamento commissioni</label>
        </div>
        
        <button class="btn-primary" onclick="completeGuideSetup()">
            🚀 REGISTRA SERVIZIO
        </button>
    </div>
    
    <!-- Venue Setup Screen -->
    <div class="venue-setup" id="venueSetup">
        <button class="back-btn" onclick="backToSelection()">←</button>
        <div style="text-align: center; margin-bottom: 2rem; margin-top: 3rem;">
            <div style="font-size: 2.5rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: 'Orbitron', monospace;">
                REGISTRA LOCALE
            </div>
            <div style="color: var(--gray); margin-top: 0.5rem;">Porta il tuo locale su SWINGOL</div>
        </div>
        
        <div class="form-group">
            <label class="form-label">🏪 Nome Locale</label>
            <input type="text" class="form-input" placeholder="Il Mio Ristorante" id="venueName">
        </div>
        
        <div class="form-group">
            <label class="form-label">📍 Indirizzo Completo</label>
            <input type="text" class="form-input" placeholder="Via Roma 1, Firenze" id="venueAddress">
        </div>
        
        <div class="form-group">
            <label class="form-label">🌐 Sito Web</label>
            <input type="url" class="form-input" placeholder="https://www.example.com" id="venueWebsite">
        </div>
        
        <div class="form-group">
            <label class="form-label">📱 Telefono</label>
            <input type="tel" class="form-input" placeholder="+39 055 1234567" id="venuePhone">
        </div>
        
        <div class="form-group">
            <label class="form-label">🍴 Tipo di Locale</label>
            <select class="form-select" id="venueType">
                <option value="restaurant">Ristorante</option>
                <option value="bar">Bar</option>
                <option value="cafe">Caffetteria</option>
                <option value="disco">Discoteca</option>
                <option value="pub">Pub</option>
                <option value="wine">Wine Bar</option>
                <option value="rooftop">Rooftop Bar</option>
                <option value="club">Club Privé</option>
                <option value="hotel">Hotel</option>
                <option value="shop">Negozio</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">🎁 Sconti Dedicati SWINGOL</label>
            <textarea class="form-textarea" placeholder="Es: 10% sconto, drink omaggio, tavolo VIP..." id="venueDiscounts"></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">📋 Carica Menu PDF</label>
            <div class="file-upload">
                <input type="file" accept=".pdf" id="venueMenu">
                <label for="venueMenu" class="file-upload-label">
                    <div>📁 Clicca per caricare</div>
                    <div style="font-size: 0.8rem; color: var(--gray); margin-top: 0.5rem;">Max 10MB - Solo PDF</div>
                </label>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">✨ Cosa ti rende speciale?</label>
            <textarea class="form-textarea" placeholder="Atmosfera unica, chef stellato, vista panoramica..." id="venueSpecial"></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">🎉 Eventi Settimanali</label>
            <textarea class="form-textarea" placeholder="Lunedì: Aperitivo\nVenerdì: DJ Set\nSabato: Live Music..." id="venueEvents"></textarea>
        </div>
        
        <div class="checkbox-container">
            <input type="checkbox" id="venueTerms">
            <label for="venueTerms" class="checkbox-label">Accetto i termini per locali e le commissioni sulle prenotazioni</label>
        </div>
        
        <button class="btn-primary" onclick="completeVenueSetup()">
            🚀 REGISTRA LOCALE
        </button>
    </div>
    
    <!-- OTP Verification Modal -->
    <div class="otp-modal" id="otpModal">
        <div class="otp-container glass-card">
            <h3 style="margin-bottom: 1rem; font-family: 'Orbitron', monospace;">Verifica numero</h3>
            <p style="color: var(--gray); margin-bottom: 2rem;">Inserisci il codice ricevuto via SMS</p>
            
            <div class="otp-inputs">
                <input type="text" class="otp-input" maxlength="1" id="otp1">
                <input type="text" class="otp-input" maxlength="1" id="otp2">
                <input type="text" class="otp-input" maxlength="1" id="otp3">
                <input type="text" class="otp-input" maxlength="1" id="otp4">
            </div>
            
            <button class="btn-primary" onclick="verifyOTP()">VERIFICA</button>
        </div>
    </div>
    
    <!-- Onboarding Screen -->
    <div class="onboarding-screen" id="onboardingScreen">
        <button class="back-btn" onclick="backToSelection()">←</button>
        <div style="text-align: center; margin: 2rem 0;">
            <div style="font-size: 2.5rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: 'Orbitron', monospace;">
                TELEPORT
            </div>
        </div>
        
        <div id="userForm">
            <div class="form-group">
                <label class="form-label">📱 Numero di telefono</label>
                <input type="tel" class="form-input" placeholder="+39 333 1234567" id="phoneNumber">
            </div>
            
            <div class="form-group">
                <label class="form-label">👤 Nome utente</label>
                <input type="text" class="form-input" placeholder="Mario_92" id="username">
            </div>
            
            <div class="form-group">
                <label class="form-label">💬 Bio</label>
                <textarea class="form-input" placeholder="Racconta qualcosa di te..." id="userBio"></textarea>
            </div>
            
            <div class="form-group" id="groupSizeContainer" style="display: none;">
                <label class="form-label">👥 Numero di persone nel gruppo</label>
                <input type="number" class="form-input" placeholder="5" min="2" max="20" id="groupSize">
            </div>
        </div>
        
        <!-- Mood Selection -->
        <div id="moodSelection">
            <div class="form-group">
                <label class="form-label">🎨 Seleziona il tuo mood (braccialetto)</label>
                <div class="mood-selector">
                    <div class="mood-card green" onclick="selectMood('green', this)">
                        <div style="font-size: 2rem;">🟢</div>
                        <div style="font-weight: 700;">APERTO</div>
                        <div style="font-size: 0.7rem;">Esplora tutto</div>
                    </div>
                    <div class="mood-card yellow" onclick="selectMood('yellow', this)">
                        <div style="font-size: 2rem;">🟡</div>
                        <div style="font-weight: 700;">SELETTIVO</div>
                        <div style="font-size: 0.7rem;">Valuto opzioni</div>
                    </div>
                    <div class="mood-card red" onclick="selectMood('red', this)">
                        <div style="font-size: 2rem;">🔴</div>
                        <div style="font-weight: 700;">RELAX</div>
                        <div style="font-size: 0.7rem;">Tranquillo</div>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="btn-primary" onclick="startTeleport()">
            🚀 TELEPORT
        </button>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Header -->
        <div class="app-header">
            <div class="user-info-header">
                <div class="user-status" id="userStatus"></div>
                <span id="userDisplayName" style="font-weight: 600;">User</span>
            </div>
            <div class="currency-container">
                <div class="currency-badge level-badge" style="position: relative;">
                    <span id="vipBadge" class="vip-indicator" style="display: none;">VIP</span>
                    <span>Lv.</span>
                    <span id="userLevel">1</span>
                </div>
                <div class="currency-badge" onclick="openShop()">
                    <span>⚡</span>
                    <span id="swingAmount">1500</span>
                </div>
                <div class="currency-badge" onclick="openShop()">
                    <span>🎯</span>
                    <span id="goalAmount">10</span>
                </div>
            </div>
        </div>
        
        <!-- Map -->
        <div class="map-wrapper">
            <div id="map"></div>
            
            <!-- AI Suggestion Banner -->
            <div class="ai-suggestion glass-card" id="aiSuggestion">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <div style="font-size: 1.5rem;">🤖</div>
                    <div>
                        <div style="font-weight: 600;" id="aiSuggestionTitle">AI analizza i tuoi interessi...</div>
                        <div style="font-size: 0.85rem; opacity: 0.8;" id="aiSuggestionDesc">Le zone consigliate si illuminano</div>
                    </div>
                </div>
            </div>
            
            <!-- AD Banner -->
            <div class="ad-banner" id="adBanner" style="display: none;">
                <div class="ad-content">
                    <div class="ad-icon">🎮</div>
                    <div class="ad-text">
                        <div class="ad-title" id="adTitle">Crypto Gaming Summit 2025</div>
                        <div class="ad-desc" id="adDesc">Unisciti a noi • 15% sconto VIP</div>
                    </div>
                </div>
                <div class="ad-close" onclick="closeAd()">✕</div>
            </div>
            
            <!-- Map Controls -->
            <div class="map-controls">
                <button class="map-btn" onclick="zoomIn()">➕</button>
                <button class="map-btn" onclick="zoomOut()">➖</button>
                <button class="map-btn" onclick="centerMap()">🎯</button>
                <button class="map-btn" onclick="toggleHeatMap()">🔥</button>
            </div>
            
            <!-- SOS Button -->
            <button class="sos-button" onclick="activateSOS()">SOS</button>
            
            <!-- Zone Popup -->
            <div class="zone-popup glass-card" id="zonePopup"></div>
            
            <!-- Group Booking Panel -->
            <div class="group-booking-panel glass-card" id="groupBookingPanel">
                <h3 style="margin-bottom: 1rem; font-family: 'Orbitron', monospace;">👥 Prenota per il gruppo</h3>
                <div id="groupVenueList"></div>
                <button class="btn-primary" style="margin-top: 1rem; background: rgba(255, 68, 68, 0.2); border: 1px solid var(--danger);" onclick="closeGroupPanel()">
                    Chiudi
                </button>
            </div>
            
            <!-- Match Request -->
            <div class="match-request glass-card" id="matchRequest">
                <div style="text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">💘</div>
                    <div style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; font-family: 'Orbitron', monospace;">Richiesta di Match!</div>
                    <div id="matchRequestText" style="margin-bottom: 1.5rem;">Sara vuole fare una caccia al tesoro con te!</div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn-primary" style="background: var(--gradient-gold);" onclick="acceptMatch()">
                            ✅ ACCETTA
                        </button>
                        <button class="btn-primary" style="background: linear-gradient(135deg, var(--danger), #DC2626);" onclick="rejectMatch()">
                            ❌ RIFIUTA
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Treasure Hunt Overlay -->
            <div class="treasure-hunt-overlay" id="treasureHuntOverlay">
                <div id="treasureMap">
                    <div class="compass-indicator">
                        <div class="compass-needle" id="compassNeedle"></div>
                    </div>
                </div>
                
                <div class="proximity-alert" id="proximityAlert">
                    🔍 Ti stai avvicinando! Preparati all'incontro
                </div>
                
                <div class="treasure-stats">
                    <div class="treasure-stat">
                        <div class="treasure-distance" id="treasureDistance">250m</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">Distanza</div>
                    </div>
                    <div class="treasure-stat">
                        <div class="treasure-eta" id="treasureETA">3 min</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">Tempo arrivo</div>
                    </div>
                    <div class="treasure-stat" id="treasureRatioContainer" style="display: none;">
                        <div class="treasure-ratio" id="treasureRatio">2:1</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">Rapporto VIP</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 0.9rem; color: var(--gray);">Incontro con</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: var(--neon-pink); font-family: 'Orbitron', monospace;" id="treasureTargetName">Marco</div>
                    <div style="font-size: 0.8rem; color: var(--crypto-gold); margin-top: 0.5rem;" id="directionIndicator">↗️ Nord-Est</div>
                </div>
                
                <div class="treasure-actions">
                    <button class="treasure-btn book" onclick="bookVenueDuringHunt()">
                        🍸 Prenota locale vicino
                    </button>
                    <button class="treasure-btn cancel" onclick="cancelTreasureHunt()">
                        Annulla caccia
                    </button>
                </div>
            </div>
            
            <!-- Venue Booking Panel -->
            <div class="venue-booking-panel glass-card" id="venueBookingPanel">
                <h3 style="margin-bottom: 1rem; font-family: 'Orbitron', monospace;">🍸 Locali vicini al percorso</h3>
                <div id="venueList"></div>
                <button class="btn-primary" style="margin-top: 1rem; background: rgba(255, 68, 68, 0.2); border: 1px solid var(--danger);" onclick="closeVenuePanel()">
                    Chiudi
                </button>
            </div>
            
            <!-- Treasure Found Modal -->
            <div class="treasure-found-modal" id="treasureFoundModal">
                <div style="font-size: 4rem; margin-bottom: 1rem;">🎉</div>
                <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; font-family: 'Orbitron', monospace;">TESORO TROVATO!</div>
                <div style="font-size: 1rem; margin-bottom: 1rem;">Hai incontrato <span id="foundUserName">Marco</span>!</div>
                <div style="font-size: 1.25rem; color: var(--crypto-gold); font-weight: 700;">+200 SWING</div>
                <button class="btn-primary" style="margin-top: 1rem; padding: 0.75rem;" onclick="closeTreasureFound()">
                    CONTINUA
                </button>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-bar">
            <div class="bottom-nav">
                <button class="nav-btn active" onclick="switchTab('map', this)">
                    <span class="nav-icon">🗺️</span>
                    <span class="nav-label">MAPPA</span>
                </button>
                <button class="nav-btn" onclick="switchTab('shop', this); openShop()">
                    <span class="nav-icon">🛒</span>
                    <span class="nav-label">SHOP</span>
                </button>
                <button class="nav-btn" onclick="switchTab('games', this); openGames()">
                    <span class="nav-icon">🎰</span>
                    <span class="nav-label">GIOCHI</span>
                </button>
                <button class="nav-btn" onclick="switchTab('quests', this); openQuests()">
                    <span class="nav-icon">🎯</span>
                    <span class="nav-label">QUEST</span>
                </button>
                <button class="nav-btn" onclick="switchTab('activity', this); openActivity()">
                    <span class="nav-icon">📊</span>
                    <span class="nav-label">ATTIVITÀ</span>
                </button>
                <button class="nav-btn" onclick="switchTab('profile', this); openProfile()">
                    <span class="nav-icon">👤</span>
                    <span class="nav-label">PROFILO</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game Overlay -->
    <div class="game-overlay" id="gameOverlay">
        <div style="background: var(--dark-card); border-radius: 20px; padding: 2rem; max-width: 400px; width: 90%; position: relative;">
            <button style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer;" onclick="closeGame()">✕</button>
            <div id="gameContent"></div>
        </div>
    </div>
    
    <!-- Particles for winning effects -->
    <div class="particles" id="particles"></div>
    
    <!-- Interest Detail Modal -->
    <div class="interest-detail-modal" id="interestDetailModal">
        <div class="interest-detail-content glass-card">
            <h3 style="margin-bottom: 1rem; font-family: 'Orbitron', monospace;">Dettagli interesse</h3>
            <div style="font-size: 2rem; text-align: center; margin-bottom: 1rem;" id="interestIcon"></div>
            <input type="text" class="form-input" id="interestDetailInput" placeholder="Es: Bitcoin, NFT art, cocktail bar...">
            <button class="btn-primary" style="margin-top: 1rem;" onclick="saveInterestDetail()">
                SALVA DETTAGLIO
            </button>
        </div>
    </div>
    
    <!-- Quests Modal -->
    <div class="modal" id="questsModal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 class="modal-title">🎯 MISSIONI & LIVELLI</h2>
                <button class="modal-close" onclick="closeModal('questsModal')">✕</button>
            </div>
            <div class="modal-body">
                <!-- Streak Display -->
                <div class="streak-container">
                    <div class="streak-number" id="streakDays">7</div>
                    <div class="streak-label">Giorni consecutivi 🔥</div>
                </div>
                
                <!-- Level Progress -->
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Livello <span id="currentLevel">1</span></span>
                        <span><span id="currentXP">250</span>/500 XP</span>
                    </div>
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" id="levelProgress" style="width: 50%;"></div>
                    </div>
                </div>
                
                <!-- Daily Quests -->
                <h3 style="margin-bottom: 1rem; color: var(--neon-blue);">📅 Missioni Giornaliere</h3>
                <div class="quest-container">
                    <div class="quest-card daily">
                        <div class="quest-info">
                            <div class="quest-title">Visita 3 zone diverse</div>
                            <div class="quest-progress">1/3 completate</div>
                            <div class="quest-progress-bar">
                                <div class="quest-progress-fill" style="width: 33%;"></div>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <div class="quest-reward-amount">+50</div>
                            <div class="quest-reward-type">SWING</div>
                        </div>
                    </div>
                    
                    <div class="quest-card daily">
                        <div class="quest-info">
                            <div class="quest-title">Fai 5 match</div>
                            <div class="quest-progress">2/5 completati</div>
                            <div class="quest-progress-bar">
                                <div class="quest-progress-fill" style="width: 40%;"></div>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <div class="quest-reward-amount">+100</div>
                            <div class="quest-reward-type">SWING</div>
                        </div>
                    </div>
                    
                    <div class="quest-card daily completed">
                        <div class="quest-info">
                            <div class="quest-title">Gioca 1 partita</div>
                            <div class="quest-progress">✅ Completata</div>
                            <div class="quest-progress-bar">
                                <div class="quest-progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <div class="quest-reward-amount">+25</div>
                            <div class="quest-reward-type">SWING</div>
                        </div>
                    </div>
                </div>
                
                <!-- Weekly Quests -->
                <h3 style="margin: 1.5rem 0 1rem; color: var(--crypto-gold);">📆 Missioni Settimanali</h3>
                <div class="quest-container">
                    <div class="quest-card weekly">
                        <div class="quest-info">
                            <div class="quest-title">Login 7 giorni consecutivi</div>
                            <div class="quest-progress">5/7 giorni</div>
                            <div class="quest-progress-bar">
                                <div class="quest-progress-fill" style="width: 71%;"></div>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <div class="quest-reward-amount">+500</div>
                            <div class="quest-reward-type">SWING</div>
                        </div>
                    </div>
                    
                    <div class="quest-card weekly">
                        <div class="quest-info">
                            <div class="quest-title">Completa 10 cacce al tesoro</div>
                            <div class="quest-progress">3/10 completate</div>
                            <div class="quest-progress-bar">
                                <div class="quest-progress-fill" style="width: 30%;"></div>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <div class="quest-reward-amount">+5</div>
                            <div class="quest-reward-type">GOAL</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Activity Modal -->
    <div class="modal" id="activityModal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 class="modal-title">📊 ATTIVITÀ IN TEMPO REALE</h2>
                <button class="modal-close" onclick="closeModal('activityModal')">✕</button>
            </div>
            <div class="modal-body">
                <!-- Live Activity Board -->
                <div class="live-activity-board">
                    <div class="live-activity-title">
                        <div class="live-pulse"></div>
                        🔴 LIVE - Cosa sta succedendo ora
                    </div>
                    <div class="activity-feed" id="liveActivityFeed" style="max-height: 200px;">
                        <!-- Le attività live verranno generate dinamicamente -->
                    </div>
                </div>
                
                <!-- Le tue attività -->
                <h3 style="margin: 1.5rem 0 1rem; color: var(--neon-blue);">🚀 Le tue attività recenti</h3>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon">🎯</div>
                        <div class="activity-text">
                            <div>Hai completato una caccia al tesoro con Marco</div>
                            <div class="activity-time">5 minuti fa</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">⚡</div>
                        <div class="activity-text">
                            <div>+100 SWING guadagnati (Mining automatico)</div>
                            <div class="activity-time">10 minuti fa</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">🎰</div>
                        <div class="activity-text">
                            <div>Hai vinto 250 SWING alla roulette!</div>
                            <div class="activity-time">15 minuti fa</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">📍</div>
                        <div class="activity-text">
                            <div>Visitata zona Santo Spirito</div>
                            <div class="activity-time">20 minuti fa</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">🆙</div>
                        <div class="activity-text">
                            <div>Livello 2 raggiunto!</div>
                            <div class="activity-time">30 minuti fa</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">💘</div>
                        <div class="activity-text">
                            <div>Match con Sara (95% affinità)</div>
                            <div class="activity-time">45 minuti fa</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">🎯</div>
                        <div class="activity-text">
                            <div>Missione giornaliera completata</div>
                            <div class="activity-time">1 ora fa</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; padding: 1rem; background: var(--dark-secondary); border-radius: 12px;">
                    <h4 style="margin-bottom: 1rem;">📈 Statistiche Oggi</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--crypto-gold);">+385</div>
                            <div style="font-size: 0.75rem; color: var(--gray);">SWING guadagnati</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--neon-pink);">4</div>
                            <div style="font-size: 0.75rem; color: var(--gray);">Match fatti</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--neon-blue);">6</div>
                            <div style="font-size: 0.75rem; color: var(--gray);">Zone visitate</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--success);">3</div>
                            <div style="font-size: 0.75rem; color: var(--gray);">Quest completate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 class="modal-title">👤 IL MIO PROFILO</h2>
                <button class="modal-close" onclick="closeModal('profileModal')">✕</button>
            </div>
            <div class="modal-body">
                <!-- Suggestion Panel for Ideas -->
                <div class="suggestion-panel">
                    <div class="suggestion-header">
                        <div class="suggestion-icon">💡</div>
                        <div>
                            <div class="suggestion-title">SUGGERISCI UN'IDEA</div>
                            <div class="suggestion-desc">Se l'amministrazione approva, guadagni SWING!</div>
                        </div>
                    </div>
                    
                    <div class="suggestion-form">
                        <textarea class="form-textarea suggestion-textarea" id="suggestionText" placeholder="Descrivi la tua idea per migliorare SWINGOL..."></textarea>
                        
                        <select class="form-select" id="suggestionCategory">
                            <option value="">Seleziona categoria</option>
                            <option value="feature">Nuova funzionalità</option>
                            <option value="improvement">Miglioramento</option>
                            <option value="partnership">Partnership</option>
                            <option value="event">Evento</option>
                            <option value="other">Altro</option>
                        </select>
                        
                        <div class="suggestion-rewards">
                            <span>💰 Ricompensa se approvata:</span>
                            <span class="suggestion-rewards-amount">100-500 SWING</span>
                        </div>
                        
                        <button class="btn-primary" onclick="submitSuggestion()">
                            📤 INVIA SUGGERIMENTO
                        </button>
                    </div>
                </div>
                
                <h3 style="margin: 2rem 0 1rem; font-family: 'Orbitron', monospace;">🎯 I TUOI INTERESSI</h3>
                <div class="interests-grid" id="profileInterests">
                    <div class="interest-chip" data-interest="crypto" onclick="toggleInterest(this)">₿ Crypto</div>
                    <div class="interest-chip" data-interest="tech" onclick="toggleInterest(this)">💻 Tech</div>
                    <div class="interest-chip" data-interest="hotel" onclick="toggleInterest(this)">🏨 Hotel</div>
                    <div class="interest-chip" data-interest="party" onclick="toggleInterest(this)">🎉 Party</div>
                    <div class="interest-chip" data-interest="food" onclick="toggleInterest(this)">🍕 Food</div>
                    <div class="interest-chip" data-interest="wine" onclick="toggleInterest(this)">🍷 Wine</div>
                    <div class="interest-chip" data-interest="arte" onclick="toggleInterest(this)">🎨 Arte</div>
                    <div class="interest-chip" data-interest="musica" onclick="toggleInterest(this)">🎵 Musica</div>
                    <div class="interest-chip" data-interest="sport" onclick="toggleInterest(this)">⚽ Sport</div>
                    <div class="interest-chip" data-interest="fashion" onclick="toggleInterest(this)">👗 Fashion</div>
                    <div class="interest-chip" data-interest="luxury" onclick="toggleInterest(this)">💎 Luxury</div>
                    <div class="interest-chip" data-interest="travel" onclick="toggleInterest(this)">✈️ Travel</div>
                    <div class="interest-chip" data-interest="wellness" onclick="toggleInterest(this)">🧘 Wellness</div>
                    <div class="interest-chip" data-interest="gaming" onclick="toggleInterest(this)">🎮 Gaming</div>
                    <div class="interest-chip" data-interest="nature" onclick="toggleInterest(this)">🌿 Nature</div>
                    <div class="interest-chip" data-interest="btc" onclick="toggleInterest(this)">🪙 BTC</div>
                    <div class="interest-chip" data-interest="disco" onclick="toggleInterest(this)">💃 Disco</div>
                    <div class="interest-chip" data-interest="rooftop" onclick="toggleInterest(this)">🏙️ Rooftop</div>
                </div>
                
                <button class="btn-primary" style="margin-top: 2rem;" onclick="confirmInterests()">
                    CONFERMA INTERESSI
                </button>
                
                <button class="btn-primary" style="margin-top: 1rem; background: var(--gradient-vip);" onclick="openVIP()">
                    ⭐ DIVENTA VIP
                </button>
            </div>
        </div>
    </div>
    
    <!-- VIP Modal -->
    <div class="modal" id="vipModal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 class="modal-title">⭐ VIP EXCLUSIVE</h2>
                <button class="modal-close" onclick="closeModal('vipModal')">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 16, 240, 0.1)); border-radius: 12px; margin-bottom: 2rem;">
                    <div style="font-size: 3rem;">👑</div>
                    <div style="font-size: 1.5rem; font-weight: 700; margin-top: 1rem; font-family: 'Orbitron', monospace;">DIVENTA VIP</div>
                </div>
                
                <h3 style="margin-bottom: 1rem; color: var(--crypto-gold);">✨ VANTAGGI ESCLUSIVI</h3>
                <div style="display: grid; gap: 0.75rem;">
                    <div style="padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                        👁️ Vedi profili completi con foto e bio
                    </div>
                    <div style="padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                        💘 Percentuali affinità precise con tutti
                    </div>
                    <div style="padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                        🎯 Caccia al tesoro 1:1 con navigazione
                    </div>
                    <div style="padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                        📊 Rapporto M/F dettagliato per zona
                    </div>
                    <div style="padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                        🎲 Rapporto VIP 2:1 nelle cacce al tesoro
                    </div>
                    <div style="padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                        🎰 Bonus +50% vincite nei giochi
                    </div>
                </div>
                
                <button class="btn-primary" style="margin-top: 2rem;" onclick="activateVIP()">
                    💎 ATTIVA VIP (5 GOAL)
                </button>
            </div>
        </div>
    </div>
    
    <!-- Shop Modal -->
    <div class="modal" id="shopModal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 class="modal-title">🛒 TOKEN SHOP</h2>
                <button class="modal-close" onclick="closeModal('shopModal')">✕</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 1.5rem; background: var(--gradient-gold); border-radius: 12px; margin-bottom: 2rem;">
                    <div style="font-size: 0.9rem; color: var(--dark);">Saldo attuale</div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--dark);">
                        ⚡ <span id="shopSwing">1500</span> SWING
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--dark);">
                        🎯 <span id="shopGoal">10</span> GOAL
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem; color: var(--crypto-gold);">🔄 Converti SWING in GOAL</h3>
                <div class="shop-item">
                    <div>
                        <div style="font-weight: 600;">1 GOAL</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">Conversione base</div>
                    </div>
                    <button class="shop-btn" onclick="convertSwing()">150 SWING</button>
                </div>
                
                <h3 style="margin: 1.5rem 0 1rem; color: var(--crypto-gold);">💎 Compra GOAL</h3>
                <div class="shop-item">
                    <div style="font-weight: 600;">10 GOAL</div>
                    <button class="shop-btn">€14,99</button>
                </div>
                <div class="shop-item">
                    <div>
                        <div style="font-weight: 600;">20 GOAL</div>
                        <div style="font-size: 0.8rem; color: var(--success);">Risparmia €2</div>
                    </div>
                    <button class="shop-btn">€27,99</button>
                </div>
                <div class="shop-item">
                    <div>
                        <div style="font-weight: 600;">35 GOAL</div>
                        <div style="font-size: 0.8rem; color: var(--success);">Risparmia €6</div>
                    </div>
                    <button class="shop-btn">€46,99</button>
                </div>
                <div class="shop-item">
                    <div>
                        <div style="font-weight: 600;">50 GOAL</div>
                        <div style="font-size: 0.8rem; color: var(--crypto-gold);">Miglior valore!</div>
                    </div>
                    <button class="shop-btn">€64,99</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Games Modal -->
    <div class="modal" id="gamesModal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 class="modal-title">🎰 GIOCHI SWINGOL</h2>
                <button class="modal-close" onclick="closeModal('gamesModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="games-grid">
                    <div class="game-card" onclick="playRoulette()">
                        <div class="game-icon">🎰</div>
                        <div class="game-title">Roulette</div>
                        <div class="game-cost">100 SWING</div>
                    </div>
                    <div class="game-card" onclick="playScratch()">
                        <div class="game-icon">🎫</div>
                        <div class="game-title">Gratta e Vinci</div>
                        <div class="game-cost">50 SWING</div>
                    </div>
                    <div class="game-card" onclick="playSlots()">
                        <div class="game-icon">🎲</div>
                        <div class="game-title">Slot Machine</div>
                        <div class="game-cost">75 SWING</div>
                    </div>
                    <div class="game-card" onclick="playWheel()">
                        <div class="game-icon">☸️</div>
                        <div class="game-title">Ruota Fortuna</div>
                        <div class="game-cost">150 SWING</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Global State
        let userType = null;
        let selectedMood = null;
        let userData = {};
        let userSwing = 1500;
        let userGoal = 10;
        let userLevel = 1;
        let userXP = 250;
        let isVIP = false;
        let isGroup = false;
        let groupSize = 1;
        let map = null;
        let treasureMap = null;
        let treasureHuntActive = false;
        let currentTreasureTarget = null;
        let selectedInterests = [];
        let interestDetails = {};
        let zoneMarkers = [];
        let zoneBoundaries = [];
        let mapZoom = 13;
        let streakDays = 7;
        let visitedZones = [];
        let completedQuests = [];
        let matchesMade = 0;
        let heatMapActive = false;
        let adIndex = 0;
        let treasureInterval = null;
        let proximityVibration = false;
        let professionalData = null;
        let venueData = null;
        let currentTab = 1;
        let suggestions = [];
        let globalActivities = [];
        let professionalActivities = [];
        let venueActivities = [];
        
        // Ads rotation
        const ads = [
            {title: "Crypto Gaming Summit 2025", desc: "Unisciti a noi • 15% sconto VIP", icon: "🎮"},
            {title: "Rooftop Party Tonight", desc: "Santo Spirito • Drink gratis VIP", icon: "🍸"},
            {title: "NFT Art Gallery", desc: "Esposizione esclusiva • Ingresso VIP", icon: "🎨"},
            {title: "Luxury Shopping Experience", desc: "Via Tornabuoni • 20% VIP discount", icon: "💎"},
            {title: "Wine Tasting Exclusive", desc: "Chianti Tour • Prenota ora", icon: "🍷"}
        ];
        
        // Venues for booking
        const venues = {
            day: [
                {name: "Caffè Gilli", type: "☕", desc: "Storico caffè fiorentino", distance: "100m"},
                {name: "Museo Uffizi", type: "🎨", desc: "Ingresso prioritario", distance: "200m"},
                {name: "Parco delle Cascine", type: "🌳", desc: "Area picnic riservata", distance: "500m"},
                {name: "Libreria Edison", type: "📚", desc: "Reading corner esclusivo", distance: "150m"}
            ],
            night: [
                {name: "Space Club", type: "💃", desc: "Tavolo VIP + bottiglia", distance: "300m"},
                {name: "Rooftop Bar Empireo", type: "🍸", desc: "Vista panoramica", distance: "250m"},
                {name: "Jazz Club Firenze", type: "🎷", desc: "Live music tonight", distance: "180m"},
                {name: "Secret Speakeasy", type: "🥃", desc: "Solo membri VIP", distance: "120m"}
            ]
        };
        
        // Professional services list
        const professionalServices = [
            {name: "Marco Bianchi", service: "Tour fotografico al tramonto", price: 80, rating: 4.9, completed: 47},
            {name: "Sofia Russo", service: "Wine tasting privato", price: 120, rating: 5.0, completed: 89},
            {name: "Giuseppe Verdi", service: "Tour artistico Uffizi", price: 65, rating: 4.8, completed: 156},
            {name: "Elena Conti", service: "Personal shopper luxury", price: 200, rating: 4.9, completed: 32}
        ];
        
        // Active venues
        const activeVenues = [
            {name: "Osteria del Borgo", type: "restaurant", offer: "20% sconto SWINGOL", customers: 28},
            {name: "Sky Lounge", type: "rooftop", offer: "Cocktail omaggio VIP", customers: 45},
            {name: "Club Babylon", type: "disco", offer: "Ingresso gratuito prima di mezzanotte", customers: 167},
            {name: "Wine Cave", type: "wine", offer: "Degustazione 3 vini", customers: 12}
        ];
        
        // Enhanced fake users for all zones
        const fakeUsers = {
            "Santo Spirito": [
                {id: 1, name: "Marco", age: 28, bio: "Crypto trader & party lover", affinity: 95, interests: ["crypto", "party"]},
                {id: 2, name: "Sofia", age: 24, bio: "Arte digitale e NFT", affinity: 72, interests: ["arte", "crypto"]},
                {id: 3, name: "Alessandro", age: 26, bio: "Developer blockchain", affinity: 88, interests: ["tech", "crypto"]},
                {id: 4, name: "Giulia", age: 23, bio: "Fashion & lifestyle", affinity: 65, interests: ["fashion", "wine"]},
                {id: 5, name: "Lorenzo", age: 29, bio: "DJ & Music producer", affinity: 91, interests: ["musica", "party"]}
            ],
            "Santa Croce": [
                {id: 6, name: "Elena", age: 25, bio: "Food blogger", affinity: 83, interests: ["food", "wine"]},
                {id: 7, name: "Francesco", age: 27, bio: "Startup founder", affinity: 77, interests: ["tech", "crypto"]},
                {id: 8, name: "Sara", age: 22, bio: "Yoga instructor", affinity: 69, interests: ["wellness", "nature"]},
                {id: 9, name: "Luca", age: 31, bio: "Sommelier professionista", affinity: 82, interests: ["wine", "food"]},
                {id: 10, name: "Valentina", age: 26, bio: "Art curator", affinity: 74, interests: ["arte", "luxury"]}
            ],
            "Centro Storico": [
                {id: 11, name: "Matteo", age: 30, bio: "Photographer", affinity: 100, interests: ["arte", "travel"]},
                {id: 12, name: "Chiara", age: 26, bio: "Event planner", affinity: 85, interests: ["party", "luxury"]},
                {id: 13, name: "Roberto", age: 35, bio: "Hotel manager", affinity: 70, interests: ["hotel", "luxury"]},
                {id: 14, name: "Silvia", age: 28, bio: "Fashion designer", affinity: 92, interests: ["fashion", "arte"]}
            ],
            "San Lorenzo": [
                {id: 15, name: "Andrea", age: 24, bio: "Gaming streamer", affinity: 78, interests: ["gaming", "tech"]},
                {id: 16, name: "Martina", age: 22, bio: "University student", affinity: 66, interests: ["party", "musica"]},
                {id: 17, name: "Paolo", age: 29, bio: "Software engineer", affinity: 84, interests: ["tech", "crypto"]},
                {id: 18, name: "Jessica", age: 27, bio: "Marketing manager", affinity: 71, interests: ["fashion", "travel"]}
            ],
            "Santa Maria Novella": [
                {id: 19, name: "Giovanni", age: 33, bio: "Wine expert", affinity: 88, interests: ["wine", "food"]},
                {id: 20, name: "Federica", age: 25, bio: "Travel blogger", affinity: 79, interests: ["travel", "hotel"]},
                {id: 21, name: "Simone", age: 30, bio: "Architect", affinity: 73, interests: ["arte", "luxury"]},
                {id: 22, name: "Laura", age: 24, bio: "Fitness coach", affinity: 67, interests: ["wellness", "sport"]}
            ],
            "Oltrarno": [
                {id: 23, name: "Davide", age: 28, bio: "Artisan jeweler", affinity: 76, interests: ["arte", "luxury"]},
                {id: 24, name: "Anna", age: 26, bio: "Painter & sculptor", affinity: 85, interests: ["arte", "nature"]},
                {id: 25, name: "Michele", age: 32, bio: "Restaurant owner", affinity: 81, interests: ["food", "wine"]},
                {id: 26, name: "Elisa", age: 23, bio: "Dance teacher", affinity: 90, interests: ["musica", "disco"]}
            ],
            "Campo di Marte": [
                {id: 27, name: "Carlo", age: 27, bio: "Personal trainer", affinity: 72, interests: ["sport", "wellness"]},
                {id: 28, name: "Beatrice", age: 29, bio: "Nutritionist", affinity: 68, interests: ["wellness", "food"]},
                {id: 29, name: "Stefano", age: 25, bio: "Football player", affinity: 75, interests: ["sport", "party"]},
                {id: 30, name: "Alice", age: 24, bio: "Physiotherapist", affinity: 70, interests: ["wellness", "nature"]}
            ],
            "Piazza della Signoria": [
                {id: 31, name: "Riccardo", age: 34, bio: "Museum curator", affinity: 87, interests: ["arte", "travel"]},
                {id: 32, name: "Francesca", age: 31, bio: "Luxury brand manager", affinity: 93, interests: ["luxury", "fashion"]},
                {id: 33, name: "Leonardo", age: 36, bio: "Art dealer", affinity: 89, interests: ["arte", "crypto"]},
                {id: 34, name: "Giorgia", age: 28, bio: "Tour guide", affinity: 77, interests: ["travel", "arte"]}
            ],
            "Ponte Vecchio": [
                {id: 35, name: "Tommaso", age: 30, bio: "Goldsmith", affinity: 82, interests: ["luxury", "arte"]},
                {id: 36, name: "Marta", age: 27, bio: "Fashion blogger", affinity: 91, interests: ["fashion", "luxury"]},
                {id: 37, name: "Nicola", age: 29, bio: "Watch collector", affinity: 86, interests: ["luxury", "crypto"]},
                {id: 38, name: "Serena", age: 25, bio: "Jewelry designer", affinity: 88, interests: ["arte", "fashion"]}
            ]
        };
        
        // Florence zones with dynamic population
        let zones = [
            {name: "Santo Spirito", lat: 43.7666, lng: 11.2478, baseUsers: 34, users: 34, males: 20, females: 14, radius: 300},
            {name: "Santa Croce", lat: 43.7686, lng: 11.2625, baseUsers: 28, users: 28, males: 16, females: 12, radius: 350},
            {name: "Centro Storico", lat: 43.7696, lng: 11.2558, baseUsers: 52, users: 52, males: 30, females: 22, radius: 400},
            {name: "San Lorenzo", lat: 43.7750, lng: 11.2535, baseUsers: 19, users: 19, males: 11, females: 8, radius: 250},
            {name: "Santa Maria Novella", lat: 43.7745, lng: 11.2494, baseUsers: 41, users: 41, males: 24, females: 17, radius: 380},
            {name: "Oltrarno", lat: 43.7650, lng: 11.2450, baseUsers: 23, users: 23, males: 13, females: 10, radius: 320},
            {name: "Campo di Marte", lat: 43.7771, lng: 11.2826, baseUsers: 15, users: 15, males: 9, females: 6, radius: 280},
            {name: "Piazza della Signoria", lat: 43.7696, lng: 11.2559, baseUsers: 67, users: 67, males: 35, females: 32, radius: 200},
            {name: "Ponte Vecchio", lat: 43.7680, lng: 11.2531, baseUsers: 45, users: 45, males: 22, females: 23, radius: 180}
        ];
        
        // Check day/night
        function checkDayNight() {
            const hour = new Date().getHours();
            const isDayTime = hour >= 6 && hour < 20;
            
            if (isDayTime) {
                document.body.classList.add('day-mode');
            } else {
                document.body.classList.remove('day-mode');
            }
            
            return isDayTime;
        }
        
        // Initialize
        window.onload = function() {
            checkDayNight();
            startDynamicPopulation();
            rotateAds();
            generateGlobalActivities();
            generateProfessionalActivities();
            generateVenueActivities();
        };
        
        // Generate global activities
        function generateGlobalActivities() {
            const activities = [
                {user: "Alessandro", zone: "Santo Spirito", action: "ha iniziato una caccia al tesoro con Sofia"},
                {user: "Club Babylon", zone: "Centro Storico", action: "ha aperto le prenotazioni VIP per stasera"},
                {user: "Marco Bianchi", zone: "Ponte Vecchio", action: "ha completato un tour fotografico (⭐5.0)"},
                {user: "Giulia", zone: "Santa Croce", action: "ha vinto 500 SWING alla roulette!"},
                {user: "Sky Lounge", zone: "Oltrarno", action: "offre 2x1 cocktails per i prossimi 30 min"},
                {user: "Paolo", zone: "San Lorenzo", action: "ha raggiunto il livello 10!"},
                {user: "Wine Cave", zone: "Santo Spirito", action: "ha 3 posti disponibili per degustazione"},
                {user: "Elena Conti", zone: "Via Tornabuoni", action: "sta guidando un tour shopping luxury"}
            ];
            
            globalActivities = activities;
            updateLiveActivityFeed();
        }
        
        // Generate professional activities
        function generateProfessionalActivities() {
            const activities = [
                {professional: "Marco Bianchi", service: "Tour fotografico", customer: "Turista americano", earned: 80, rating: 5},
                {professional: "Sofia Russo", service: "Wine tasting", customer: "Coppia francese", earned: 240, rating: 5},
                {professional: "Giuseppe Verdi", service: "Tour Uffizi", customer: "Gruppo giapponese", earned: 325, rating: 4.8},
                {professional: "Elena Conti", service: "Personal shopping", customer: "Cliente VIP", earned: 200, rating: 5}
            ];
            
            professionalActivities = activities;
        }
        
        // Generate venue activities
        function generateVenueActivities() {
            const activities = [
                {venue: "Osteria del Borgo", action: "prenotazione gruppo 8 persone", time: "20:30"},
                {venue: "Sky Lounge", action: "evento privato confermato", time: "22:00"},
                {venue: "Club Babylon", action: "DJ internazionale stasera", time: "23:30"},
                {venue: "Wine Cave", action: "degustazione Brunello sold out", time: "19:00"}
            ];
            
            venueActivities = activities;
        }
        
        // Update live activity feed
        function updateLiveActivityFeed() {
            const feed = document.getElementById('liveActivityFeed');
            if (!feed) return;
            
            feed.innerHTML = globalActivities.map((activity, index) => `
                <div class="activity-item" style="animation-delay: ${index * 0.1}s;">
                    <div class="activity-icon">${getActivityIcon(activity.action)}</div>
                    <div class="activity-text">
                        <div>
                            <span class="activity-user">${activity.user}</span> 
                            ${activity.zone ? `in <span class="activity-zone">${activity.zone}</span>` : ''} 
                            ${activity.action}
                        </div>
                        <div class="activity-time">${getRandomTime()}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Get activity icon based on action
        function getActivityIcon(action) {
            if (action.includes('caccia')) return '🎯';
            if (action.includes('prenotazioni') || action.includes('offre')) return '🎫';
            if (action.includes('tour') || action.includes('guidando')) return '📸';
            if (action.includes('vinto')) return '🎰';
            if (action.includes('cocktail')) return '🍸';
            if (action.includes('livello')) return '🆙';
            if (action.includes('degustazione')) return '🍷';
            if (action.includes('shopping')) return '💎';
            return '📍';
        }
        
        // Get random time
        function getRandomTime() {
            const times = ['ora', '2 min fa', '5 min fa', '10 min fa', '15 min fa'];
            return times[Math.floor(Math.random() * times.length)];
        }
        
        // Dynamic population simulation
        function startDynamicPopulation() {
            setInterval(() => {
                const hour = new Date().getHours();
                const isPeakTime = (hour >= 19 && hour <= 23) || (hour >= 12 && hour <= 14);
                
                zones = zones.map(zone => {
                    let variation = Math.random() * 10 - 5; // ±5 base variation
                    
                    if (isPeakTime) {
                        variation += Math.random() * 20; // Extra boost during peak
                    }
                    
                    const newUsers = Math.max(5, Math.floor(zone.baseUsers + variation));
                    const maleRatio = 0.45 + Math.random() * 0.2;
                    
                    return {
                        ...zone,
                        users: newUsers,
                        males: Math.floor(newUsers * maleRatio),
                        females: newUsers - Math.floor(newUsers * maleRatio)
                    };
                });
                
                if (map) {
                    updateZoneMarkers();
                }
                
                // Update live activities
                generateGlobalActivities();
                updateLiveActivityFeed();
            }, 30000); // Update every 30 seconds
        }
        
        // Rotate ads
        function rotateAds() {
            setInterval(() => {
                if (document.getElementById('appContainer').style.display !== 'none') {
                    showAd();
                }
            }, 45000); // Show ad every 45 seconds
        }
        
        function showAd() {
            const ad = ads[adIndex % ads.length];
            const banner = document.getElementById('adBanner');
            document.getElementById('adTitle').textContent = ad.title;
            document.getElementById('adDesc').textContent = ad.desc;
            banner.querySelector('.ad-icon').textContent = ad.icon;
            banner.style.display = 'flex';
            
            adIndex++;
            
            setTimeout(() => {
                if (banner.style.display === 'flex') {
                    banner.style.display = 'none';
                }
            }, 10000);
        }
        
        function closeAd() {
            document.getElementById('adBanner').style.display = 'none';
        }
        
        // Switch main tab
        function switchMainTab(tabNum, element) {
            currentTab = tabNum;
            
            // Update active tab
            document.querySelectorAll('.tri-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            
            // Move indicator
            const indicator = document.getElementById('tabIndicator');
            indicator.className = 'tri-tab-indicator';
            if (tabNum === 2) indicator.classList.add('tab-2');
            if (tabNum === 3) indicator.classList.add('tab-3');
            
            // Show corresponding content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tabContent${tabNum}`).classList.add('active');
        }
        
        // Back to selection
        function backToSelection() {
            document.getElementById('professionalSetup').classList.remove('active');
            document.getElementById('venueSetup').classList.remove('active');
            document.getElementById('onboardingScreen').classList.remove('active');
            document.getElementById('triTabSelection').classList.remove('hidden');
        }
        
        // User type selection
        function selectUserType(type) {
            userType = type;
            
            if (type === 'guide' || type === 'photographer' || type === 'influencer') {
                // Show professional setup
                document.getElementById('triTabSelection').classList.add('hidden');
                document.getElementById('professionalSetup').classList.add('active');
            } else if (type === 'restaurant' || type === 'bar' || type === 'venue') {
                // Show venue setup
                document.getElementById('triTabSelection').classList.add('hidden');
                document.getElementById('venueSetup').classList.add('active');
            } else if (type === 'group') {
                // Group mode
                isGroup = true;
                document.getElementById('triTabSelection').classList.add('hidden');
                document.getElementById('onboardingScreen').classList.add('active');
                document.getElementById('groupSizeContainer').style.display = 'block';
            } else if (type === 'vip') {
                // VIP demo
                isVIP = true;
                userGoal = 50;
                document.getElementById('triTabSelection').classList.add('hidden');
                document.getElementById('onboardingScreen').classList.add('active');
                document.getElementById('username').value = 'VIP Demo User';
                document.getElementById('phoneNumber').value = '+39 333 0000000';
            } else {
                // Normal user
                document.getElementById('triTabSelection').classList.add('hidden');
                document.getElementById('onboardingScreen').classList.add('active');
            }
        }
        
        // Complete guide setup
        function completeGuideSetup() {
            const name = document.getElementById('guideName').value;
            const email = document.getElementById('guideEmail').value;
            const phone = document.getElementById('guidePhone').value;
            const vat = document.getElementById('guideVat').value;
            const service = document.getElementById('guideService').value;
            const description = document.getElementById('guideDescription').value;
            const price = document.getElementById('guidePrice').value;
            const terms = document.getElementById('guideTerms').checked;
            
            if (!name || !email || !phone || !vat || !description || !price || !terms) {
                showToast('⚠️ Completa tutti i campi e accetta i termini');
                return;
            }
            
            professionalData = {
                name,
                email,
                phone,
                vat,
                service,
                description,
                price
            };
            
            // Hide professional setup and show onboarding
            document.getElementById('professionalSetup').classList.remove('active');
            document.getElementById('onboardingScreen').classList.add('active');
            
            // Pre-fill some data
            document.getElementById('username').value = name;
            document.getElementById('phoneNumber').value = phone;
            
            // Add professional to activities
            professionalActivities.push({
                professional: name,
                service: service,
                status: "Disponibile ora",
                price: price
            });
        }
        
        // Complete venue setup
        function completeVenueSetup() {
            const name = document.getElementById('venueName').value;
            const address = document.getElementById('venueAddress').value;
            const website = document.getElementById('venueWebsite').value;
            const phone = document.getElementById('venuePhone').value;
            const type = document.getElementById('venueType').value;
            const discounts = document.getElementById('venueDiscounts').value;
            const special = document.getElementById('venueSpecial').value;
            const events = document.getElementById('venueEvents').value;
            const terms = document.getElementById('venueTerms').checked;
            
            if (!name || !address || !phone || !special || !terms) {
                showToast('⚠️ Completa tutti i campi obbligatori e accetta i termini');
                return;
            }
            
            venueData = {
                name,
                address,
                website,
                phone,
                type,
                discounts: discounts ? discounts.split('\n') : [],
                special,
                events
            };
            
            // Hide venue setup and show onboarding
            document.getElementById('venueSetup').classList.remove('active');
            document.getElementById('onboardingScreen').classList.add('active');
            
            // Pre-fill some data
            document.getElementById('username').value = name;
            document.getElementById('phoneNumber').value = phone;
            
            // Add venue to activities
            venueActivities.push({
                venue: name,
                action: "si è registrato su SWINGOL",
                offers: discounts
            });
        }
        
        // Mood selection
        function selectMood(mood, element) {
            document.querySelectorAll('.mood-card').forEach(card => card.classList.remove('active'));
            element.classList.add('active');
            selectedMood = mood;
        }
        
        // Start Teleport
        function startTeleport() {
            userData = {
                username: document.getElementById('username').value || 'Demo User',
                phone: document.getElementById('phoneNumber').value || '+39 333 0000000',
                bio: document.getElementById('userBio').value || 'SWINGOL user',
                mood: selectedMood || 'green'
            };
            
            if (isGroup) {
                groupSize = parseInt(document.getElementById('groupSize').value) || 2;
            }
            
            if (!userData.username || !userData.phone) {
                showToast('⚠️ Completa tutti i campi');
                return;
            }
            
            // Show OTP verification
            showOTP();
        }
        
        // OTP Verification
        function showOTP() {
            document.getElementById('otpModal').classList.add('active');
            // Auto-fill for demo
            setTimeout(() => {
                document.getElementById('otp1').value = '1';
                document.getElementById('otp2').value = '2';
                document.getElementById('otp3').value = '3';
                document.getElementById('otp4').value = '4';
            }, 1000);
        }
        
        function verifyOTP() {
            showToast('✅ Numero verificato!');
            document.getElementById('otpModal').classList.remove('active');
            completeOnboarding();
        }
        
        // Complete onboarding
        function completeOnboarding() {
            document.getElementById('onboardingScreen').classList.remove('active');
            document.getElementById('appContainer').style.display = 'flex';
            
            document.getElementById('userDisplayName').textContent = userData.username;
            
            // Set user status color based on type
            if (userType === 'guide' || userType === 'photographer' || userType === 'influencer') {
                document.getElementById('userStatus').style.background = '#FFD700';
                showToast('🎯 Benvenuto Professionista! Il tuo servizio è ora visibile sulla mappa');
                
                // Add professional services to zones
                setTimeout(() => {
                    addProfessionalToMap();
                }, 2000);
            } else if (userType === 'restaurant' || userType === 'bar' || userType === 'venue') {
                document.getElementById('userStatus').style.background = '#FF10F0';
                showToast('🏪 Benvenuto! Il tuo locale è ora visibile sulla mappa');
                
                // Add venue to map
                setTimeout(() => {
                    addVenueToMap();
                }, 2000);
            } else if (isGroup) {
                document.getElementById('userStatus').style.background = '#9333EA';
                showToast(`👥 Gruppo di ${groupSize} persone creato!`);
            } else {
                const moodColors = {
                    green: '#10B981',
                    yellow: '#F59E0B',
                    red: '#FF4444'
                };
                document.getElementById('userStatus').style.background = moodColors[userData.mood];
            }
            
            if (isVIP) {
                document.getElementById('vipBadge').style.display = 'block';
                document.getElementById('treasureRatioContainer').style.display = 'block';
            }
            
            updateCurrency();
            
            // Initialize map
            setTimeout(() => {
                initializeMap();
                // Show first ad after 5 seconds
                setTimeout(showAd, 5000);
            }, 100);
        }
        
        // Add professional marker to map
        function addProfessionalToMap() {
            if (!map) return;
            
            // Add professional marker at Piazza della Repubblica
            const profMarker = L.marker([43.7714, 11.2541], {
                icon: L.divIcon({
                    html: `<div style="background: linear-gradient(135deg, #FFD700, #FF8C00); padding: 0.5rem; border-radius: 12px; color: white; font-weight: 700; border: 2px solid white; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.5);">
                        🎯 Tour disponibile
                    </div>`,
                    iconSize: [150, 40]
                })
            }).addTo(map);
            
            profMarker.on('click', () => {
                showProfessionalDetails();
            });
            
            showToast('📍 Il tuo servizio è ora visibile sulla mappa!');
            
            // Add to global activities
            globalActivities.unshift({
                user: professionalData.name,
                zone: "Piazza della Repubblica",
                action: "offre tour guidati"
            });
            updateLiveActivityFeed();
        }
        
        // Add venue marker to map
        function addVenueToMap() {
            if (!map) return;
            
            // Add venue marker at San Lorenzo
            const venueIcon = {
                restaurant: '🍝',
                bar: '🍸',
                cafe: '☕',
                disco: '💃',
                pub: '🍺',
                wine: '🍷',
                rooftop: '🏙️',
                club: '🎭',
                hotel: '🏨',
                shop: '🛍️'
            };
            
            const venueMarker = L.marker([43.7750, 11.2535], {
                icon: L.divIcon({
                    html: `<div style="background: linear-gradient(135deg, #FF10F0, #00D4FF); padding: 0.5rem; border-radius: 12px; color: white; font-weight: 700; border: 2px solid white; box-shadow: 0 4px 20px rgba(255, 16, 240, 0.5);">
                        ${venueIcon[venueData.type] || '🏪'} ${venueData.discounts.length > 0 ? venueData.discounts[0] : 'APERTO'}
                    </div>`,
                    iconSize: [150, 40]
                })
            }).addTo(map);
            
            venueMarker.on('click', () => {
                showVenueDetails();
            });
            
            showToast('🏪 Il tuo locale è ora visibile a tutti gli utenti!');
            
            // Add to global activities
            globalActivities.unshift({
                user: venueData.name,
                zone: "San Lorenzo",
                action: "ha aperto le prenotazioni"
            });
            updateLiveActivityFeed();
        }
        
        // Initialize Map
        function initializeMap() {
            map = L.map('map', {
                zoomControl: false
            }).setView([43.7696, 11.2558], mapZoom);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap',
                maxZoom: 19
            }).addTo(map);
            
            // Add futuristic zone boundaries
            zones.forEach(zone => {
                const circle = L.circle([zone.lat, zone.lng], {
                    radius: zone.radius,
                    color: '#00D4FF',
                    fillColor: '#00D4FF',
                    fillOpacity: 0.1,
                    weight: 2,
                    opacity: 0.5,
                    dashArray: '5, 10',
                    className: 'zone-boundary'
                }).addTo(map);
                
                circle.on('click', () => {
                    showZoneDetails(zone);
                    trackZoneVisit(zone.name);
                });
                zoneBoundaries.push(circle);
            });
            
            // Add zone markers
            updateZoneMarkers();
            
            // Update markers on map move/zoom
            map.on('moveend zoomend', updateZoneMarkers);
            
            // Auto-zoom based on density
            map.on('zoomend', () => {
                mapZoom = map.getZoom();
            });
        }
        
        // Toggle heat map
        function toggleHeatMap() {
            heatMapActive = !heatMapActive;
            
            if (heatMapActive) {
                zoneBoundaries.forEach((boundary, index) => {
                    const zone = zones[index];
                    const intensity = zone.users / 70;
                    const color = `rgba(255, ${Math.floor(255 * (1 - intensity))}, 0, ${0.3 + intensity * 0.4})`;
                    
                    boundary.setStyle({
                        fillColor: color,
                        fillOpacity: 0.4 + intensity * 0.3,
                        dashArray: '10, 5'
                    });
                });
                showToast('🔥 Heat Map attivata');
            } else {
                updateZoneMarkers();
                showToast('🗺️ Vista normale');
            }
        }
        
        // Update zone markers with futuristic style
        function updateZoneMarkers() {
            // Remove existing markers
            zoneMarkers.forEach(marker => {
                if (marker && marker.parentNode) {
                    marker.parentNode.removeChild(marker);
                }
            });
            zoneMarkers = [];
            
            // Add new markers
            zones.forEach((zone, index) => {
                const point = map.latLngToContainerPoint([zone.lat, zone.lng]);
                
                const marker = document.createElement('div');
                marker.className = 'zone-marker glass-card';
                marker.style.left = point.x + 'px';
                marker.style.top = point.y + 'px';
                
                // Set affinity class based on user interests
                if (selectedInterests.length > 0) {
                    const affinity = calculateZoneAffinity(zone);
                    if (affinity > 70) {
                        marker.classList.add('affinity-high');
                        if (!heatMapActive && zoneBoundaries[index]) {
                            zoneBoundaries[index].setStyle({
                                color: '#FF10F0',
                                fillColor: '#FF10F0',
                                dashArray: '15, 5'
                            });
                        }
                    } else if (affinity > 40) {
                        marker.classList.add('affinity-medium');
                        if (!heatMapActive && zoneBoundaries[index]) {
                            zoneBoundaries[index].setStyle({
                                color: '#10FFB5',
                                fillColor: '#10FFB5',
                                dashArray: '10, 10'
                            });
                        }
                    } else {
                        marker.classList.add('affinity-low');
                        if (!heatMapActive && zoneBoundaries[index]) {
                            zoneBoundaries[index].setStyle({
                                color: '#64748B',
                                fillColor: '#64748B',
                                dashArray: '5, 10'
                            });
                        }
                    }
                }
                
                // Dynamic pulse for hot zones
                if (zone.users > 50) {
                    marker.style.animation = 'pulseHigh 1.5s infinite';
                }
                
                marker.innerHTML = `
                    <div style="font-weight: 700; font-size: 1.2rem;">${zone.users}</div>
                    <div style="font-size: 0.75rem; opacity: 0.8;">${zone.name}</div>
                    ${isVIP ? `<div style="font-size: 0.65rem; color: var(--crypto-gold);">♂${zone.males} ♀${zone.females}</div>` : ''}
                `;
                
                marker.onclick = () => {
                    showZoneDetails(zone);
                    trackZoneVisit(zone.name);
                };
                
                document.querySelector('.map-wrapper').appendChild(marker);
                zoneMarkers.push(marker);
            });
        }
        
        // Show zone details with activities
        function showZoneDetails(zone) {
            const popup = document.getElementById('zonePopup');
            const users = fakeUsers[zone.name] || [];
            
            // Find professional services in this zone
            const zoneServices = professionalServices.filter(() => Math.random() > 0.5).slice(0, 2);
            const zoneVenues = activeVenues.filter(() => Math.random() > 0.5).slice(0, 2);
            
            if (isGroup) {
                // Group view
                popup.innerHTML = `
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 1.25rem; font-weight: 700; font-family: 'Orbitron', monospace;">${zone.name}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">
                                    👥 ${zone.users} persone • Gruppo di ${groupSize}
                                </div>
                            </div>
                            <button style="background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer;" onclick="closeZonePopup()">✕</button>
                        </div>
                        
                        <button class="btn-primary" style="background: var(--gradient-gold);" onclick="openGroupBooking()">
                            🍽️ PRENOTA PER IL GRUPPO
                        </button>
                        
                        <div style="margin-top: 1rem; padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">🔍 Locali consigliati per gruppi</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">
                                • Ristorante da Gino (tavolo 10 persone)<br>
                                • Rooftop Terrace (area privata)<br>
                                • Jazz Club (saletta riservata)
                            </div>
                        </div>
                    </div>
                `;
            } else if (isVIP) {
                popup.innerHTML = `
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 1.25rem; font-weight: 700; font-family: 'Orbitron', monospace;">${zone.name}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">
                                    👥 ${zone.users} persone · ♂${zone.males} ♀${zone.females}
                                </div>
                            </div>
                            <button style="background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer;" onclick="closeZonePopup()">✕</button>
                        </div>
                        
                        ${zoneServices.length > 0 ? `
                            <div style="margin-bottom: 1rem; padding: 0.75rem; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.1)); border-radius: 8px; border: 1px solid var(--crypto-gold);">
                                <div style="font-weight: 600; color: var(--crypto-gold); margin-bottom: 0.5rem;">🎯 Servizi professionali attivi</div>
                                ${zoneServices.map(service => `
                                    <div style="padding: 0.25rem 0; font-size: 0.85rem;">
                                        • ${service.name}: ${service.service} (€${service.price})
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${zoneVenues.length > 0 ? `
                            <div style="margin-bottom: 1rem; padding: 0.75rem; background: linear-gradient(135deg, rgba(255, 16, 240, 0.1), rgba(0, 212, 255, 0.1)); border-radius: 8px; border: 1px solid var(--neon-pink);">
                                <div style="font-weight: 600; color: var(--neon-pink); margin-bottom: 0.5rem;">🏪 Locali con offerte attive</div>
                                ${zoneVenues.map(venue => `
                                    <div style="padding: 0.25rem 0; font-size: 0.85rem;">
                                        • ${venue.name}: ${venue.offer} (${venue.customers} persone ora)
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--crypto-gold);">
                            Utenti nella zona (${users.length})
                        </div>
                        
                        ${users.slice(0, 5).map(user => `
                            <div class="user-card" onclick="inviteTreasureHunt(${user.id}, '${user.name}')">
                                ${user.affinity >= 85 ? `<div class="affinity-badge">${user.affinity}%</div>` : ''}
                                <div class="user-avatar">👤</div>
                                <div class="user-details">
                                    <div class="user-name">${user.name}, ${user.age}</div>
                                    <div class="user-bio">${user.bio}</div>
                                </div>
                            </div>
                        `).join('')}
                        
                        <div style="margin-top: 1rem; padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; font-size: 0.85rem; color: var(--gray);">
                            💡 Clicca su un utente per invitare alla caccia al tesoro 1:1 (2 GOAL)
                        </div>
                    </div>
                `;
            } else {
                popup.innerHTML = `
                    <div>
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🔒</div>
                            <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; font-family: 'Orbitron', monospace;">${zone.name}</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--crypto-gold); margin-bottom: 1rem;">
                                ${zone.users} persone
                            </div>
                            
                            ${zoneServices.length > 0 || zoneVenues.length > 0 ? `
                                <div style="margin-bottom: 1rem; padding: 0.75rem; background: var(--dark-secondary); border-radius: 8px; text-align: left;">
                                    <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem;">📍 Attività in zona:</div>
                                    <div style="font-size: 0.75rem; color: var(--gray);">
                                        ${zoneServices.length} servizi professionali<br>
                                        ${zoneVenues.length} locali con offerte
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div style="margin-bottom: 1.5rem; color: var(--gray);">
                                Attiva VIP per vedere profili e dettagli
                            </div>
                            <button class="btn-primary" onclick="openVIP()">
                                ⭐ ATTIVA VIP
                            </button>
                        </div>
                        <button style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer;" onclick="closeZonePopup()">✕</button>
                    </div>
                `;
            }
            
            popup.classList.add('active');
        }
        
        // Show professional details popup
        function showProfessionalDetails() {
            const popup = document.getElementById('zonePopup');
            const recentActivities = professionalActivities.slice(0, 3);
            
            popup.innerHTML = `
                <div style="text-align: center; padding: 1rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">🎯</div>
                    <div style="font-size: 1.25rem; font-weight: 700; font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">
                        ${professionalData.name}
                    </div>
                    <div style="color: var(--crypto-gold); font-weight: 600; margin-bottom: 1rem;">
                        Guida Turistica Certificata • P.IVA ${professionalData.vat}
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--success);">
                        <div style="font-weight: 600; color: var(--success); margin-bottom: 0.5rem;">✅ Attività recenti</div>
                        ${recentActivities.map(activity => `
                            <div style="font-size: 0.8rem; padding: 0.25rem 0;">
                                ${activity.service} per ${activity.customer} • ⭐${activity.rating}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: var(--dark-secondary); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                        <div style="text-align: left; margin-bottom: 0.5rem;">
                            <strong>📝 Servizio:</strong><br>${professionalData.description}
                        </div>
                        <div style="text-align: left; margin-bottom: 0.5rem;">
                            <strong>💰 Prezzo:</strong> €${professionalData.price}/persona
                        </div>
                        <div style="text-align: left; margin-bottom: 0.5rem;">
                            <strong>📧 Contatto:</strong> ${professionalData.email}
                        </div>
                        <div style="text-align: left;">
                            <strong>⚡ Guadagni oggi:</strong> ${professionalActivities.reduce((sum, a) => sum + (a.earned || 0), 0)} SWING
                        </div>
                    </div>
                    
                    <div style="display: grid; gap: 0.5rem;">
                        <button class="btn-primary" onclick="bookProfessional()">
                            📅 PRENOTA ORA (2 GOAL)
                        </button>
                        <button style="padding: 0.5rem; background: var(--dark-secondary); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--light); cursor: pointer;">
                            📄 Scarica Brochure PDF
                        </button>
                    </div>
                    <button style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer;" onclick="closeZonePopup()">✕</button>
                </div>
            `;
            popup.classList.add('active');
        }
        
        // Show venue details popup
        function showVenueDetails() {
            const popup = document.getElementById('zonePopup');
            const recentActivities = venueActivities.slice(0, 3);
            
            popup.innerHTML = `
                <div style="padding: 1rem;">
                    <div style="text-align: center; font-size: 2rem; margin-bottom: 1rem;">
                        ${venueData.type === 'restaurant' ? '🍝' : venueData.type === 'bar' ? '🍸' : '🏪'}
                    </div>
                    <div style="font-size: 1.25rem; font-weight: 700; font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">
                        ${venueData.name}
                    </div>
                    <div style="color: var(--gray); margin-bottom: 1rem;">
                        📍 ${venueData.address}
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(255, 16, 240, 0.1), rgba(0, 212, 255, 0.1)); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--neon-pink);">
                        <div style="font-weight: 600; color: var(--neon-pink); margin-bottom: 0.5rem;">🔴 Attività live</div>
                        ${recentActivities.map(activity => `
                            <div style="font-size: 0.8rem; padding: 0.25rem 0;">
                                ${activity.time ? activity.time + ' - ' : ''}${activity.action}
                            </div>
                        `).join('')}
                    </div>
                    
                    ${venueData.discounts.length > 0 ? `
                        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 16, 240, 0.1)); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                            <div style="font-weight: 600; color: var(--crypto-gold); margin-bottom: 0.5rem;">✨ Offerte SWINGOL</div>
                            ${venueData.discounts.map(offer => `
                                <div style="padding: 0.25rem 0;">• ${offer}</div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div style="background: var(--dark-secondary); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">🌟 Cosa ci rende speciali</div>
                        <div style="font-size: 0.9rem;">${venueData.special}</div>
                    </div>
                    
                    ${venueData.events ? `
                        <div style="background: var(--dark-secondary); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">🎉 Eventi settimanali</div>
                            <div style="font-size: 0.9rem; white-space: pre-line;">${venueData.events}</div>
                        </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn-primary" onclick="bookVenue()">
                            📅 PRENOTA (1 GOAL)
                        </button>
                        <button style="padding: 0.75rem; background: var(--dark-secondary); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--light); cursor: pointer;">
                            📋 Menu PDF
                        </button>
                    </div>
                    <button style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--light); font-size: 1.5rem; cursor: pointer;" onclick="closeZonePopup()">✕</button>
                </div>
            `;
            popup.classList.add('active');
        }
        
        // Book professional service
        function bookProfessional() {
            if (userGoal >= 2) {
                userGoal -= 2;
                updateCurrency();
                closeZonePopup();
                showToast(`✅ Tour prenotato con ${professionalData.name}! Riceverai conferma via SMS`);
                
                // Add to activities
                globalActivities.unshift({
                    user: userData.username,
                    zone: "Piazza della Repubblica",
                    action: `ha prenotato un tour con ${professionalData.name}`
                });
                updateLiveActivityFeed();
            } else {
                showToast('⚠️ Servono 2 GOAL per prenotare');
            }
        }
        
        // Book venue
        function bookVenue() {
            if (userGoal >= 1) {
                userGoal -= 1;
                updateCurrency();
                closeZonePopup();
                showToast(`✅ Tavolo prenotato presso ${venueData.name}!`);
                
                // Add to activities
                globalActivities.unshift({
                    user: userData.username,
                    zone: "San Lorenzo",
                    action: `ha prenotato presso ${venueData.name}`
                });
                updateLiveActivityFeed();
            } else {
                showToast('⚠️ Serve 1 GOAL per prenotare');
            }
        }
        
        // Open group booking
        function openGroupBooking() {
            closeZonePopup();
            const panel = document.getElementById('groupBookingPanel');
            const isDayTime = checkDayNight();
            const venueList = isDayTime ? venues.day : venues.night;
            
            document.getElementById('groupVenueList').innerHTML = venueList.map(venue => `
                <div class="venue-card" onclick="confirmGroupBooking('${venue.name}')">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 2rem;">${venue.type}</div>
                        <div>
                            <div style="font-weight: 600;">${venue.name}</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">${venue.desc}</div>
                            <div style="font-size: 0.75rem; color: var(--crypto-gold);">📍 ${venue.distance}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            panel.classList.add('active');
        }
        
        function confirmGroupBooking(venueName) {
            const depositGoal = Math.ceil(groupSize / 2);
            if (userGoal >= depositGoal) {
                userGoal -= depositGoal;
                updateCurrency();
                closeGroupPanel();
                showToast(`✅ Prenotato ${venueName} per ${groupSize} persone! Caparra: ${depositGoal} GOAL`);
            } else {
                showToast(`⚠️ Servono ${depositGoal} GOAL per la caparra (10% del totale)`);
            }
        }
        
        function closeGroupPanel() {
            document.getElementById('groupBookingPanel').classList.remove('active');
        }
        
        function closeZonePopup() {
            document.getElementById('zonePopup').classList.remove('active');
        }
        
        // Track zone visits for quests
        function trackZoneVisit(zoneName) {
            if (!visitedZones.includes(zoneName)) {
                visitedZones.push(zoneName);
                checkQuestProgress('zones', visitedZones.length);
            }
        }
        
        // Check quest progress
        function checkQuestProgress(type, value) {
            let message = '';
            let reward = 0;
            
            if (type === 'zones' && value === 3) {
                reward = 50;
                message = '✅ Quest completata: Visita 3 zone! +50 SWING';
                completedQuests.push('daily_zones');
            } else if (type === 'matches' && value === 5) {
                reward = 100;
                message = '✅ Quest completata: Fai 5 match! +100 SWING';
                completedQuests.push('daily_matches');
            } else if (type === 'games' && value === 1) {
                reward = 25;
                message = '✅ Quest completata: Gioca 1 partita! +25 SWING';
                completedQuests.push('daily_games');
            }
            
            if (reward > 0) {
                userSwing += reward;
                updateCurrency();
                showToast(message);
            }
        }
        
        // Calculate zone affinity
        function calculateZoneAffinity(zone) {
            if (selectedInterests.length === 0) return 0;
            
            const affinityMap = {
                "Santo Spirito": ["party", "crypto", "musica", "disco", "btc"],
                "Santa Croce": ["food", "wine", "arte"],
                "Centro Storico": ["luxury", "fashion", "travel", "hotel"],
                "San Lorenzo": ["tech", "gaming", "crypto", "btc"],
                "Santa Maria Novella": ["hotel", "travel", "luxury", "rooftop"],
                "Oltrarno": ["arte", "nature", "wellness"],
                "Campo di Marte": ["sport", "wellness", "nature"],
                "Piazza della Signoria": ["arte", "travel", "luxury"],
                "Ponte Vecchio": ["fashion", "luxury", "arte"]
            };
            
            const zoneInterests = affinityMap[zone.name] || [];
            const matches = selectedInterests.filter(i => zoneInterests.includes(i)).length;
            return (matches / Math.max(selectedInterests.length, 1)) * 100;
        }
        
        // Toggle interest
        function toggleInterest(element) {
            const interest = element.dataset.interest;
            
            if (element.classList.contains('active')) {
                element.classList.remove('active');
                selectedInterests = selectedInterests.filter(i => i !== interest);
                delete interestDetails[interest];
            } else {
                // Show detail modal
                document.getElementById('interestIcon').textContent = element.textContent;
                document.getElementById('interestDetailInput').value = interestDetails[interest] || '';
                document.getElementById('interestDetailInput').dataset.interest = interest;
                document.getElementById('interestDetailModal').classList.add('active');
                
                element.classList.add('active');
                if (!selectedInterests.includes(interest)) {
                    selectedInterests.push(interest);
                }
            }
        }
        
        // Save interest detail
        function saveInterestDetail() {
            const input = document.getElementById('interestDetailInput');
            const interest = input.dataset.interest;
            const detail = input.value;
            
            if (detail) {
                interestDetails[interest] = detail;
            }
            
            document.getElementById('interestDetailModal').classList.remove('active');
        }
        
        // Confirm interests
        function confirmInterests() {
            if (selectedInterests.length === 0) {
                showToast('⚠️ Seleziona almeno un interesse');
                return;
            }
            
            closeModal('profileModal');
            
            // Show AI analysis
            const aiSuggestion = document.getElementById('aiSuggestion');
            document.getElementById('aiSuggestionTitle').textContent = '🤖 AI sta analizzando i tuoi interessi...';
            document.getElementById('aiSuggestionDesc').textContent = `Trovati ${selectedInterests.length} interessi`;
            aiSuggestion.classList.add('active');
            
            // Simulate AI processing
            setTimeout(() => {
                // Update zone colors based on affinity
                updateZoneMarkers();
                
                // Find best zones
                const bestZones = zones
                    .map(z => ({...z, affinity: calculateZoneAffinity(z)}))
                    .sort((a, b) => b.affinity - a.affinity)
                    .slice(0, 3);
                
                document.getElementById('aiSuggestionTitle').textContent = `✨ AI consiglia: ${bestZones[0].name}`;
                document.getElementById('aiSuggestionDesc').textContent = `${bestZones[0].affinity}% affinità con i tuoi interessi`;
                
                setTimeout(() => {
                    aiSuggestion.classList.remove('active');
                }, 5000);
            }, 2000);
        }
        
        // Enhanced Treasure Hunt
        function inviteTreasureHunt(userId, userName) {
            if (userGoal >= 2) {
                userGoal -= 2;
                updateCurrency();
                
                closeZonePopup();
                showToast(`💘 Invito inviato a ${userName}!`);
                
                // Simulate acceptance notification
                setTimeout(() => {
                    const matchRequest = document.getElementById('matchRequest');
                    document.getElementById('matchRequestText').textContent = `${userName} vuole fare una caccia al tesoro con te!`;
                    matchRequest.classList.add('active');
                    
                    currentTreasureTarget = userName;
                }, 2000);
            } else {
                showToast('⚠️ Servono 2 GOAL per la caccia al tesoro');
            }
        }
        
        function acceptMatch() {
            document.getElementById('matchRequest').classList.remove('active');
            showToast('✅ Match accettato!');
            matchesMade++;
            checkQuestProgress('matches', matchesMade);
            startTreasureHunt();
        }
        
        function rejectMatch() {
            document.getElementById('matchRequest').classList.remove('active');
            showToast('❌ Match rifiutato');
        }
        
        // Enhanced Realistic Treasure Hunt (CORRECTED - only SWING reward, no GOAL)
        function startTreasureHunt() {
            treasureHuntActive = true;
            
            document.getElementById('treasureTargetName').textContent = currentTreasureTarget;
            document.getElementById('treasureHuntOverlay').classList.add('active');
            
            // Show VIP ratio if VIP
            if (isVIP) {
                document.getElementById('treasureRatioContainer').style.display = 'block';
                document.getElementById('treasureRatio').textContent = '2:1';
            }
            
            // Initialize treasure map
            if (!treasureMap) {
                treasureMap = L.map('treasureMap', {
                    zoomControl: false
                }).setView([43.7696, 11.2558], 16);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(treasureMap);
            }
            
            // Starting positions
            const myPos = [43.7696, 11.2558];
            const targetPos = [43.7686, 11.2625];
            
            // My marker
            const myMarker = L.marker(myPos, {
                icon: L.divIcon({
                    html: '<div style="width: 30px; height: 30px; background: linear-gradient(135deg, #6366F1, #EC4899); border-radius: 50%; border: 3px solid white;"></div>',
                    iconSize: [30, 30]
                })
            }).addTo(treasureMap);
            
            // Target marker
            const targetMarker = L.marker(targetPos, {
                icon: L.divIcon({
                    html: '<div style="width: 30px; height: 30px; background: var(--gradient-gold); border-radius: 50%; border: 3px solid white;"></div>',
                    iconSize: [30, 30]
                })
            }).addTo(treasureMap);
            
            // Animated route with curves
            const routeLine = L.polyline([myPos, targetPos], {
                color: '#00D4FF',
                weight: 4,
                opacity: 0.8,
                dashArray: '10, 10',
                dashOffset: '0'
            }).addTo(treasureMap);
            
            // Animate route
            let offset = 0;
            setInterval(() => {
                offset = (offset + 1) % 20;
                routeLine.setStyle({dashOffset: offset});
            }, 100);
            
            // Realistic distance simulation
            let distance = 350 + Math.random() * 100;
            let velocity = 0;
            let acceleration = 0;
            let direction = 0;
            
            treasureInterval = setInterval(() => {
                // Simulate realistic movement
                const randomAccel = (Math.random() - 0.5) * 5;
                acceleration = acceleration * 0.8 + randomAccel * 0.2;
                velocity = Math.max(0, Math.min(5, velocity + acceleration));
                
                distance = Math.max(0, distance - velocity - Math.random() * 3);
                
                direction = (direction + (Math.random() - 0.5) * 30 + 360) % 360;
                const compass = document.getElementById('compassNeedle');
                if (compass) {
                    compass.style.transform = `rotate(${direction}deg)`;
                }
                
                const dirIndicator = document.getElementById('directionIndicator');
                const dirMap = {
                    0: '⬆️ Nord',
                    45: '↗️ Nord-Est',
                    90: '➡️ Est',
                    135: '↘️ Sud-Est',
                    180: '⬇️ Sud',
                    225: '↙️ Sud-Ovest',
                    270: '⬅️ Ovest',
                    315: '↖️ Nord-Ovest'
                };
                const nearestDir = Math.round(direction / 45) * 45 % 360;
                if (dirIndicator) {
                    dirIndicator.textContent = dirMap[nearestDir] || '⬆️ Nord';
                }
                
                document.getElementById('treasureDistance').textContent = Math.floor(distance) + 'm';
                document.getElementById('treasureETA').textContent = Math.ceil(distance / 80) + ' min';
                
                if (distance < 50 && !proximityVibration) {
                    proximityVibration = true;
                    document.getElementById('proximityAlert').classList.add('active');
                    
                    const overlay = document.getElementById('treasureHuntOverlay');
                    overlay.style.animation = 'none';
                    setTimeout(() => {
                        overlay.style.animation = 'proximityPulse 0.5s ease 3';
                    }, 10);
                }
                
                if (myMarker && treasureMap) {
                    const newLat = myPos[0] + (targetPos[0] - myPos[0]) * (1 - distance / 450);
                    const newLng = myPos[1] + (targetPos[1] - myPos[1]) * (1 - distance / 450);
                    myMarker.setLatLng([newLat, newLng]);
                    treasureMap.panTo([newLat, newLng]);
                }
                
                if (distance <= 0) {
                    clearInterval(treasureInterval);
                    treasureFound();
                }
            }, 1000);
        }
        
        // Book venue during hunt
        function bookVenueDuringHunt() {
            const panel = document.getElementById('venueBookingPanel');
            const isDayTime = checkDayNight();
            const venueList = isDayTime ? venues.day : venues.night;
            
            document.getElementById('venueList').innerHTML = venueList.map(venue => `
                <div class="venue-card" onclick="confirmVenueBooking('${venue.name}')">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 2rem;">${venue.type}</div>
                        <div>
                            <div style="font-weight: 600;">${venue.name}</div>
                            <div style="font-size: 0.85rem; color: var(--gray);">${venue.desc}</div>
                            <div style="font-size: 0.75rem; color: var(--crypto-gold);">📍 ${venue.distance}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            panel.classList.add('active');
        }
        
        function confirmVenueBooking(venueName) {
            closeVenuePanel();
            showToast(`✅ Prenotato ${venueName} per 2 persone!`);
        }
        
        function closeVenuePanel() {
            document.getElementById('venueBookingPanel').classList.remove('active');
        }
        
        function cancelTreasureHunt() {
            if (treasureInterval) {
                clearInterval(treasureInterval);
            }
            document.getElementById('treasureHuntOverlay').classList.remove('active');
            document.getElementById('proximityAlert').classList.remove('active');
            treasureHuntActive = false;
            proximityVibration = false;
            showToast('Caccia al tesoro annullata');
        }
        
        // CORRECTED: Treasure found - only SWING reward, no GOAL
        function treasureFound() {
            document.getElementById('treasureHuntOverlay').classList.remove('active');
            document.getElementById('proximityAlert').classList.remove('active');
            proximityVibration = false;
            
            const foundModal = document.getElementById('treasureFoundModal');
            document.getElementById('foundUserName').textContent = currentTreasureTarget;
            foundModal.classList.add('active');
            
            // CORRECTED: Only SWING reward, no GOAL
            const baseReward = 200;
            const vipMultiplier = isVIP ? 2 : 1;
            const totalSwingReward = baseReward * vipMultiplier;
            userSwing += totalSwingReward;
            // REMOVED: userGoal += 1;
            updateCurrency();
            
            createParticles();
            
            if (isVIP) {
                showToast(`🎉 Bonus VIP! +${totalSwingReward} SWING`);
            } else {
                showToast(`🎉 Tesoro trovato! +${totalSwingReward} SWING`);
            }
            
            // Add to activities
            globalActivities.unshift({
                user: userData.username,
                zone: "Centro",
                action: `ha completato una caccia al tesoro con ${currentTreasureTarget}`
            });
            updateLiveActivityFeed();
        }
        
        function closeTreasureFound() {
            document.getElementById('treasureFoundModal').classList.remove('active');
        }
        
        // Map controls
        function zoomIn() {
            if (map) {
                map.zoomIn();
                mapZoom = map.getZoom();
            }
        }
        
        function zoomOut() {
            if (map) {
                map.zoomOut();
                mapZoom = map.getZoom();
            }
        }
        
        function centerMap() {
            if (map) {
                map.setView([43.7696, 11.2558], 13);
                mapZoom = 13;
            }
        }
        
        // Navigation
        function switchTab(tab, element) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
        }
        
        // Enhanced Games
        function openGames() {
            document.getElementById('gamesModal').classList.add('active');
        }
        
        function playRoulette() {
            if (userSwing >= 100) {
                userSwing -= 100;
                updateCurrency();
                
                closeModal('gamesModal');
                const overlay = document.getElementById('gameOverlay');
                overlay.classList.add('active');
                
                document.getElementById('gameContent').innerHTML = `
                    <div class="roulette-container">
                        <h2 style="text-align: center; font-family: 'Orbitron', monospace; margin-bottom: 1rem;">🎰 ROULETTE CRYPTO</h2>
                        <div style="position: relative;">
                            <div class="roulette-wheel" id="rouletteWheel"></div>
                            <div class="roulette-pointer"></div>
                        </div>
                        <div class="roulette-result" id="rouletteResult"></div>
                        <button class="btn-primary" style="margin-top: 1rem;" onclick="spinRoulette()">GIRA LA RUOTA</button>
                    </div>
                `;
                
                checkQuestProgress('games', 1);
            } else {
                showToast('⚠️ Servono 100 SWING');
            }
        }
        
        function spinRoulette() {
            const wheel = document.getElementById('rouletteWheel');
            const result = document.getElementById('rouletteResult');
            
            wheel.classList.add('spinning');
            result.classList.remove('show');
            
            playSound('spin');
            
            setTimeout(() => {
                wheel.classList.remove('spinning');
                const win = Math.random() > 0.5;
                
                if (win) {
                    const baseWin = Math.floor(Math.random() * 300) + 100;
                    const vipBonus = isVIP ? Math.floor(baseWin * 0.5) : 0;
                    const totalWin = baseWin + vipBonus;
                    
                    userSwing += totalWin;
                    updateCurrency();
                    
                    result.innerHTML = `
                        <div style="color: var(--crypto-gold);">🎉 HAI VINTO!</div>
                        <div>+${baseWin} SWING</div>
                        ${vipBonus > 0 ? `<div style="font-size: 0.9rem;">+${vipBonus} Bonus VIP</div>` : ''}
                    `;
                    result.classList.add('show');
                    
                    createParticles();
                    playSound('win');
                } else {
                    result.innerHTML = `<div style="color: var(--danger);">😔 Ritenta!</div>`;
                    result.classList.add('show');
                    playSound('lose');
                }
            }, 5000);
        }
        
        function playScratch() {
            if (userSwing >= 50) {
                userSwing -= 50;
                updateCurrency();
                
                closeModal('gamesModal');
                const overlay = document.getElementById('gameOverlay');
                overlay.classList.add('active');
                
                document.getElementById('gameContent').innerHTML = `
                    <div style="text-align: center;">
                        <h2 style="font-family: 'Orbitron', monospace; margin-bottom: 1rem;">🎫 GRATTA E VINCI</h2>
                        <div class="scratch-container">
                            <canvas id="scratchCanvas" width="300" height="200"></canvas>
                            <div class="scratch-result" id="scratchResult">
                                <div style="font-family: 'Orbitron', monospace;">500 SWING!</div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; color: var(--gray);">Gratta per scoprire il premio!</div>
                    </div>
                `;
                
                initScratchCard();
                checkQuestProgress('games', 1);
            } else {
                showToast('⚠️ Servono 50 SWING');
            }
        }
        
        function initScratchCard() {
            const canvas = document.getElementById('scratchCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, 300, 200);
            gradient.addColorStop(0, '#FFD700');
            gradient.addColorStop(0.5, '#FF10F0');
            gradient.addColorStop(1, '#00D4FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 300, 200);
            
            ctx.font = 'bold 24px Orbitron';
            ctx.fillStyle = '#0A0E1A';
            ctx.textAlign = 'center';
            ctx.fillText('GRATTA QUI', 150, 100);
            
            let isScratching = false;
            let scratchedPercent = 0;
            
            canvas.addEventListener('mousedown', () => isScratching = true);
            canvas.addEventListener('mouseup', () => isScratching = false);
            canvas.addEventListener('mousemove', (e) => {
                if (!isScratching) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                const imageData = ctx.getImageData(0, 0, 300, 200);
                let transparent = 0;
                for (let i = 3; i < imageData.data.length; i += 4) {
                    if (imageData.data[i] === 0) transparent++;
                }
                scratchedPercent = (transparent / (300 * 200)) * 100;
                
                if (scratchedPercent > 60 && !canvas.revealed) {
                    canvas.revealed = true;
                    revealScratchResult();
                }
            });
            
            canvas.addEventListener('touchstart', () => isScratching = true);
            canvas.addEventListener('touchend', () => isScratching = false);
            canvas.addEventListener('touchmove', (e) => {
                if (!isScratching) return;
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        function revealScratchResult() {
            const win = Math.random() > 0.3;
            const result = document.getElementById('scratchResult');
            
            if (win) {
                const amount = Math.floor(Math.random() * 500) + 50;
                const vipBonus = isVIP ? Math.floor(amount * 0.5) : 0;
                
                userSwing += amount + vipBonus;
                updateCurrency();
                
                result.innerHTML = `
                    <div style="color: var(--crypto-gold); font-size: 2rem;">🎉</div>
                    <div style="font-family: 'Orbitron', monospace; font-size: 1.5rem;">
                        ${amount} SWING!
                        ${vipBonus > 0 ? `<div style="font-size: 0.9rem;">+${vipBonus} VIP</div>` : ''}
                    </div>
                `;
                
                createParticles();
                playSound('win');
            } else {
                result.innerHTML = `
                    <div style="color: var(--gray); font-size: 1.5rem;">💔</div>
                    <div>Riprova!</div>
                `;
                playSound('lose');
            }
            
            const canvas = document.getElementById('scratchCanvas');
            if (canvas) {
                canvas.style.opacity = '0';
                canvas.style.transition = 'opacity 0.5s ease';
            }
        }
        
        function playSlots() {
            if (userSwing >= 75) {
                userSwing -= 75;
                updateCurrency();
                
                closeModal('gamesModal');
                const overlay = document.getElementById('gameOverlay');
                overlay.classList.add('active');
                
                document.getElementById('gameContent').innerHTML = `
                    <div style="text-align: center;">
                        <h2 style="font-family: 'Orbitron', monospace; margin-bottom: 1rem;">🎲 SLOT MACHINE</h2>
                        <div class="slot-machine" id="slotMachine">
                            <div class="slot-reel">
                                <div class="slot-symbols" id="reel1">
                                    <div class="slot-symbol">💎</div>
                                    <div class="slot-symbol">💘</div>
                                    <div class="slot-symbol">🔔</div>
                                    <div class="slot-symbol">⭐</div>
                                    <div class="slot-symbol">7️⃣</div>
                                </div>
                            </div>
                            <div class="slot-reel">
                                <div class="slot-symbols" id="reel2">
                                    <div class="slot-symbol">💘</div>
                                    <div class="slot-symbol">💎</div>
                                    <div class="slot-symbol">7️⃣</div>
                                    <div class="slot-symbol">🔔</div>
                                    <div class="slot-symbol">⭐</div>
                                </div>
                            </div>
                            <div class="slot-reel">
                                <div class="slot-symbols" id="reel3">
                                    <div class="slot-symbol">⭐</div>
                                    <div class="slot-symbol">7️⃣</div>
                                    <div class="slot-symbol">💘</div>
                                    <div class="slot-symbol">💎</div>
                                    <div class="slot-symbol">🔔</div>
                                </div>
                            </div>
                        </div>
                        <button class="btn-primary" style="margin-top: 2rem;" onclick="spinSlots()">GIRA!</button>
                        <div style="margin-top: 1rem; font-size: 1.5rem; font-weight: 700; color: var(--crypto-gold); opacity: 0;" id="slotResult"></div>
                    </div>
                `;
                
                checkQuestProgress('games', 1);
            } else {
                showToast('⚠️ Servono 75 SWING');
            }
        }
        
        function spinSlots() {
            const machine = document.getElementById('slotMachine');
            machine.classList.add('spinning');
            
            for (let i = 1; i <= 3; i++) {
                const reel = document.getElementById(`reel${i}`);
                const offset = Math.floor(Math.random() * 5) * 100;
                setTimeout(() => {
                    reel.style.transform = `translateY(-${1500 + offset}px)`;
                }, i * 200);
            }
            
            setTimeout(() => {
                machine.classList.remove('spinning');
                
                const win = Math.random() > 0.6;
                const result = document.getElementById('slotResult');
                
                if (win) {
                    const amount = Math.floor(Math.random() * 400) + 150;
                    const vipBonus = isVIP ? Math.floor(amount * 0.5) : 0;
                    
                    userSwing += amount + vipBonus;
                    updateCurrency();
                    
                    result.textContent = `🎉 +${amount + vipBonus} SWING!`;
                    result.style.opacity = '1';
                    
                    createParticles();
                    playSound('win');
                } else {
                    result.textContent = '😔 Riprova!';
                    result.style.opacity = '1';
                    result.style.color = 'var(--danger)';
                    playSound('lose');
                }
            }, 3500);
        }
        
        function playWheel() {
            showToast('☸️ Ruota Fortuna in arrivo presto!');
        }
        
        function closeGame() {
            document.getElementById('gameOverlay').classList.remove('active');
        }
        
        // Particle effects
        function createParticles() {
            const container = document.getElementById('particles');
            container.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                container.appendChild(particle);
            }
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 4000);
        }
        
        function playSound(type) {
            console.log(`Playing sound: ${type}`);
        }
        
        // Quests
        function openQuests() {
            document.getElementById('questsModal').classList.add('active');
            document.getElementById('streakDays').textContent = streakDays;
            document.getElementById('currentLevel').textContent = userLevel;
            document.getElementById('currentXP').textContent = userXP;
            document.getElementById('levelProgress').style.width = (userXP / 500 * 100) + '%';
        }
        
        // Activity
        function openActivity() {
            updateLiveActivityFeed();
            document.getElementById('activityModal').classList.add('active');
        }
        
        // Profile
        function openProfile() {
            document.getElementById('profileModal').classList.add('active');
        }
        
        // Submit suggestion
        function submitSuggestion() {
            const text = document.getElementById('suggestionText').value;
            const category = document.getElementById('suggestionCategory').value;
            
            if (!text || !category) {
                showToast('⚠️ Completa tutti i campi');
                return;
            }
            
            suggestions.push({
                text,
                category,
                timestamp: new Date(),
                status: 'pending'
            });
            
            document.getElementById('suggestionText').value = '';
            document.getElementById('suggestionCategory').value = '';
            
            showToast('📤 Suggerimento inviato! Se approvato riceverai 100-500 SWING');
            
            // Simulate approval after 5 seconds
            setTimeout(() => {
                const reward = Math.floor(Math.random() * 400) + 100;
                userSwing += reward;
                updateCurrency();
                showToast(`✅ Suggerimento approvato! +${reward} SWING`);
            }, 5000);
        }
        
        // VIP
        function openVIP() {
            closeZonePopup();
            document.getElementById('vipModal').classList.add('active');
        }
        
        function activateVIP() {
            if (userGoal >= 5) {
                userGoal -= 5;
                isVIP = true;
                updateCurrency();
                document.getElementById('vipBadge').style.display = 'block';
                document.getElementById('treasureRatioContainer').style.display = 'block';
                closeModal('vipModal');
                showToast('⭐ VIP ATTIVATO! Ora puoi vedere tutti i profili');
                
                updateZoneMarkers();
            } else {
                showToast('⚠️ Servono 5 GOAL per VIP');
            }
        }
        
        // Shop
        function openShop() {
            document.getElementById('shopModal').classList.add('active');
            document.getElementById('shopSwing').textContent = userSwing;
            document.getElementById('shopGoal').textContent = userGoal;
        }
        
        function convertSwing() {
            if (userSwing >= 150) {
                userSwing -= 150;
                userGoal += 1;
                updateCurrency();
                document.getElementById('shopSwing').textContent = userSwing;
                document.getElementById('shopGoal').textContent = userGoal;
                showToast('✅ Convertiti 150 SWING in 1 GOAL');
            } else {
                showToast('⚠️ SWING insufficienti');
            }
        }
        
        // SOS
        function activateSOS() {
            if (confirm('⚠️ ATTIVARE MODALITÀ EMERGENZA?\n\nVerranno avvisati i contatti di emergenza')) {
                showToast('🆘 EMERGENZA ATTIVATA - Posizione inviata');
                
                document.body.style.animation = 'sosPulse 0.5s ease 3';
                setTimeout(() => {
                    document.body.style.animation = '';
                }, 1500);
            }
        }
        
        // Update currency display
        function updateCurrency() {
            document.getElementById('swingAmount').textContent = userSwing;
            document.getElementById('goalAmount').textContent = userGoal;
            document.getElementById('userLevel').textContent = userLevel;
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Mining simulation
        setInterval(() => {
            const miningRate = isVIP ? 10 : 5;
            userSwing += miningRate;
            userXP += 2;
            
            if (userXP >= 500) {
                userLevel++;
                userXP = userXP % 500;
                userSwing += 500;
                showToast(`🆙 LEVEL UP! Livello ${userLevel} raggiunto! +500 SWING`);
                createParticles();
            }
            
            updateCurrency();
        }, 10000);
    </script>
</body>
</html>
